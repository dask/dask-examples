

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Xarray with Dask Arrays &mdash; Dask Examples  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script type="text/javascript" src="_static/js/custom.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/explore.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/nbsphinx.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="DataFrames: Read and Write Data" href="dataframes/01-data-access.html" />
    <link rel="prev" title="Dask for Machine Learning" href="machine-learning.html" />
  <link rel="shortcut icon" href="_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

  

<nav id="explore-links">
  <a href="https://docs.dask.org/">
    <img class="caption" src="_static/images/dask-horizontal-white.svg"/>
  </a>

  <ul>
    <li>
      <a>Get Started</a>
      <ul>
        <li><a href="https://docs.dask.org/en/latest/install.html"> Install </a></li>
        <li><a href="https://examples.dask.org"> Examples </a></li>
        <li><a href="https://github.com/dask/dask-tutorial"> Tutorial </a></li>
        <li><a href="https://docs.dask.org/en/latest/why.html"> Why Dask? </a></li>
        <li><a href="https://stories.dask.org/en/latest"> Use Cases </a></li>
        <li><a href="https://www.youtube.com/watch?v=RA_2qdipVng&list=PLRtz5iA93T4PQvWuoMnIyEIz1fXiJ5Pri"> Talks </a></li>
        <li><a href="https://mybinder.org/v2/gh/dask/dask-examples/master?urlpath=lab"> Try Online </a></li>
        <li><a href="https://dask.org/slides"> Slides </a></li>
      </ul>
    </li>

    <li>
      <a href="">Algorithms</a>
      <ul>
        <li><a href="https://docs.dask.org/en/latest/array.html">Arrays</a></li>
        <li><a href="https://docs.dask.org/en/latest/dataframe.html">Dataframes</a></li>
        <li><a href="https://docs.dask.org/en/latest/bag.html">Bags</a></li>
        <li><a href="https://docs.dask.org/en/latest/delayed.html">Delayed (custom)</a></li>
        <li><a href="https://docs.dask.org/en/latest/futures.html">Futures (real-time)</a></li>
        <li><a href="http://ml.dask.org">Machine Learning</a></li>
        <li><a href="https://xarray.pydata.org/en/latest/">XArray</a></li>
      </ul>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/setup.html">Setup</a>
      <ul>
        <li><a href="https://docs.dask.org/en/latest/setup/single-machine.html"> Local </a></li>
        <li><a href="https://docs.dask.org/en/latest/setup/cloud.html"> Cloud </a></li>
        <li><a href="https://docs.dask.org/en/latest/setup/hpc.html"> HPC </a></li>
        <li><a href="https://kubernetes.dask.org/en/latest/"> Kubernetes </a></li>
        <li><a href="https://yarn.dask.org/en/latest/"> Hadoop / Yarn </a></li>
      </ul>
    </li>

    <li>
      <a>Community</a>
      <ul>
        <li><a href="http://docs.dask.org/en/latest/support.html">Ask for Help</a></li>
        <li><a href="https://github.com/dask">Github</a></li>
        <li><a href="https://stackoverflow.com/questions/tagged/dask">Stack Overflow</a></li>
        <li><a href="https://twitter.com/dask_dev">Twitter</a></li>
        <li><a href="https://blog.dask.org/"> Developer Blog </a></li>
      </ul>
    </li>
  </ul>

</nav>


  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Dask Examples
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basic Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="array.html">Dask Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="bag.html">Dask Bags</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataframe.html">Dask DataFrames</a></li>
<li class="toctree-l1"><a class="reference internal" href="delayed.html">Custom Workloads with Dask Delayed</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">Custom Workloads with Futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning.html">Dask for Machine Learning</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Xarray with Dask Arrays</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Start-Dask-Client-for-Dashboard">Start Dask Client for Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Open-a-sample-dataset">Open a sample dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Use-Standard-Xarray-Operations">Use Standard Xarray Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Persist-data-in-memory">Persist data in memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Time-Series-Operations">Time Series Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Custom-workflows-and-automatic-parallelization">Custom workflows and automatic parallelization</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Dataframes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dataframes/01-data-access.html">DataFrames: Read and Write Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataframes/02-groupby.html">DataFrames: Groupby</a></li>
</ul>
<p class="caption"><span class="caption-text">Machine Learning:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/scale-scikit-learn.html">Scale Scikit-Learn for Small Data Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/parallel-prediction.html">Score and Predict Large Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/training-on-large-datasets.html">Train Models on Large Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/incremental.html">Incrementally Train Large Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/hyperparam-opt.html">Hyperparameter optimization with Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/xgboost.html">Scale XGBoost</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/voting-classifier.html">Use Voting Classifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/tpot.html">Automate Machine Learning with TPOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/glm.html">Generalized Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning/svd.html">Singular Value Decomposition</a></li>
</ul>
<p class="caption"><span class="caption-text">Applications:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="applications/json-data-on-the-web.html">Analyze web-hosted JSON data</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/async-await.html">Async/Await and Non-Blocking Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/async-web-server.html">Asynchronous Computation: Web Servers + Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/embarrassingly-parallel.html">Embarrassingly parallel Workloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/evolving-workflows.html">Handle Evolving Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/image-processing.html">Image Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/prefect-etl.html">ETL Pipelines with Prefect</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/satellite-imagery-geotiff.html">Reading and manipulating tiled GeoTIFF datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications/stencils-with-numba.html">Stencil Computations with Numba</a></li>
</ul>
<p class="caption"><span class="caption-text">User Surveys:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="surveys/2019.html">2019 Dask User Survey Results</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Dask Examples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Xarray with Dask Arrays</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/xarray.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition-live-notebook admonition">
<p class="admonition-title">Live Notebook</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/master?urlpath=lab/tree/xarray.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/master?urlpath=lab/tree/xarray.ipynb"><img alt="Binder" src="https://mybinder.org/badge.svg" /></a> or view it <a class="reference external" href="https://github.com/dask/dask-examples/blob/master/xarray.ipynb">on Github</a>.</p>
</div>
<div class="section" id="Xarray-with-Dask-Arrays">
<h1>Xarray with Dask Arrays<a class="headerlink" href="#Xarray-with-Dask-Arrays" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://xarray.pydata.org/en/stable/">Xarray</a> is an open source project and Python package that extends the labeled data functionality of <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> to N-dimensional array-like datasets. It shares a similar API to <a class="reference external" href="http://www.numpy.org/">NumPy</a> and <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> and supports both <a class="reference external" href="https://dask.org/">Dask</a> and <a class="reference external" href="http://www.numpy.org/">NumPy</a> arrays under the hood.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="k">import</span> <span class="n">Client</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
</pre></div>
</div>
</div>
<div class="section" id="Start-Dask-Client-for-Dashboard">
<h2>Start Dask Client for Dashboard<a class="headerlink" href="#Start-Dask-Client-for-Dashboard" title="Permalink to this headline">¶</a></h2>
<p>Starting the Dask Client is optional. It will provide a dashboard which is useful to gain insight on the computation.</p>
<p>The link to the dashboard will become visible when you create the client below. We recommend having it open on one side of your screen while using your notebook on the other side. This can take some effort to arrange your windows, but seeing them both at the same is very useful when learning.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">n_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="s1">&#39;1GB&#39;</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table style="border: 2px solid white;">
<tr>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Client</h3>
<ul style="text-align: left; list-style: none; margin: 0; padding: 0;">
  <li><b>Scheduler: </b>tcp://127.0.0.1:45631</li>
  <li><b>Dashboard: </b><a href='http://127.0.0.1:8787/status' target='_blank'>http://127.0.0.1:8787/status</a>
</ul>
</td>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Cluster</h3>
<ul style="text-align: left; list-style:none; margin: 0; padding: 0;">
  <li><b>Workers: </b>2</li>
  <li><b>Cores: </b>4</li>
  <li><b>Memory: </b>2.00 GB</li>
</ul>
</td>
</tr>
</table></div>
</div>
</div>
<div class="section" id="Open-a-sample-dataset">
<h2>Open a sample dataset<a class="headerlink" href="#Open-a-sample-dataset" title="Permalink to this headline">¶</a></h2>
<p>We will use some of xarray’s tutorial data for this example. By specifying the chunk shape, xarray will automatically create Dask arrays for each data variable in the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code>. In xarray, <code class="docutils literal notranslate"><span class="pre">Datasets</span></code> are dict-like container of labeled arrays, analogous to the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>. Note that we’re taking advantage of xarray’s dimension labels when specifying chunk shapes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">tutorial</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;air_temperature&#39;</span><span class="p">,</span>
                              <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.Dataset&gt;
Dimensions:  (lat: 25, lon: 53, time: 2920)
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
  * time     (time) datetime64[ns] 2013-01-01 ... 2014-12-31T18:00:00
Data variables:
    air      (time, lat, lon) float32 dask.array&lt;chunksize=(2920, 25, 25), meta=np.ndarray&gt;
Attributes:
    Conventions:  COARDS
    title:        4x daily NMC reanalysis (1948)
    description:  Data is from NMC initialized reanalysis\n(4x/day).  These a...
    platform:     Model
    references:   http://www.esrl.noaa.gov/psd/data/gridded/data.ncep.reanaly...
</pre></div>
</div>
</div>
<p>Quickly inspecting the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> above, we’ll note that this <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> has three <em>dimensions</em> akin to axes in NumPy (<code class="docutils literal notranslate"><span class="pre">lat</span></code>, <code class="docutils literal notranslate"><span class="pre">lon</span></code>, and <code class="docutils literal notranslate"><span class="pre">time</span></code>), three <em>coordinate variables</em> akin to <code class="docutils literal notranslate"><span class="pre">pandas.Index</span></code> objects (also named <code class="docutils literal notranslate"><span class="pre">lat</span></code>, <code class="docutils literal notranslate"><span class="pre">lon</span></code>, and <code class="docutils literal notranslate"><span class="pre">time</span></code>), and one data variable (<code class="docutils literal notranslate"><span class="pre">air</span></code>). Xarray also holds Dataset specific metadata in as <em>attributes</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;air&#39;</span><span class="p">]</span>
<span class="n">da</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray &#39;air&#39; (time: 2920, lat: 25, lon: 53)&gt;
dask.array&lt;open_dataset-6cada6d3623090ff60be64c96bdd6f84air, shape=(2920, 25, 53), dtype=float32, chunksize=(2920, 25, 25), chunktype=numpy.ndarray&gt;
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
  * time     (time) datetime64[ns] 2013-01-01 ... 2014-12-31T18:00:00
Attributes:
    long_name:     4xDaily Air temperature at sigma level 995
    units:         degK
    precision:     2
    GRIB_id:       11
    GRIB_name:     TMP
    var_desc:      Air temperature
    dataset:       NMC Reanalysis
    level_desc:    Surface
    statistic:     Individual Obs
    parent_stat:   Other
    actual_range:  [185.16 322.1 ]
</pre></div>
</div>
</div>
<p>Each data variable in xarray is called a <code class="docutils literal notranslate"><span class="pre">DataArray</span></code>. These are the fundemental labeled array object in xarray. Much like the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code>, <code class="docutils literal notranslate"><span class="pre">DataArrays</span></code> also have <em>dimensions</em> and <em>coordinates</em> that support many of its label-based opperations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">da</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 15.48 MB </td> <td> 7.30 MB </td></tr>
    <tr><th> Shape </th><td> (2920, 25, 53) </td> <td> (2920, 25, 25) </td></tr>
    <tr><th> Count </th><td> 4 Tasks </td><td> 3 Chunks </td></tr>
    <tr><th> Type </th><td> float32 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="159" height="146" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="25" x2="80" y2="96" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="25" style="stroke-width:2" />
  <line x1="80" y1="70" x2="80" y2="96" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 80.588235,70.588235 80.588235,96.000852 10.000000,25.412617" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="38" y2="0" style="stroke-width:2" />
  <line x1="80" y1="70" x2="109" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="23" y1="0" x2="94" y2="70" />
  <line x1="36" y1="0" x2="107" y2="70" />
  <line x1="38" y1="0" x2="109" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 38.489733,0.000000 109.077968,70.588235 80.588235,70.588235" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="109" y2="70" style="stroke-width:2" />
  <line x1="80" y1="96" x2="109" y2="96" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="96" style="stroke-width:2" />
  <line x1="94" y1="70" x2="94" y2="96" />
  <line x1="107" y1="70" x2="107" y2="96" />
  <line x1="109" y1="70" x2="109" y2="96" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.588235,70.588235 109.077968,70.588235 109.077968,96.000852 80.588235,96.000852" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="94.833102" y="116.000852" font-size="1.0rem" font-weight="100" text-anchor="middle" >53</text>
  <text x="129.077968" y="83.294544" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,129.077968,83.294544)">25</text>
  <text x="35.294118" y="80.706734" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,80.706734)">2920</text>
</svg>
</td>
</tr>
</table></div>
</div>
<p>Accessing the underlying array of data is done via the <code class="docutils literal notranslate"><span class="pre">data</span></code> property. Here we can see that we have a Dask array. If this array were to be backed by a NumPy array, this property would point to the actual values in the array.</p>
</div>
<div class="section" id="Use-Standard-Xarray-Operations">
<h2>Use Standard Xarray Operations<a class="headerlink" href="#Use-Standard-Xarray-Operations" title="Permalink to this headline">¶</a></h2>
<p>In almost all cases, operations using xarray objects are identical, regardless if the underlying data is stored as a Dask array or a NumPy array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">da2</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">da3</span> <span class="o">=</span> <span class="n">da</span> <span class="o">-</span> <span class="n">da2</span>
<span class="n">da3</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray &#39;air&#39; (time: 2920, lat: 25, lon: 53, month: 12)&gt;
dask.array&lt;sub, shape=(2920, 25, 53, 12), dtype=float32, chunksize=(2920, 25, 25, 1), chunktype=numpy.ndarray&gt;
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
  * time     (time) datetime64[ns] 2013-01-01 ... 2014-12-31T18:00:00
  * month    (month) int64 1 2 3 4 5 6 7 8 9 10 11 12
</pre></div>
</div>
</div>
<p>Call <code class="docutils literal notranslate"><span class="pre">.compute()</span></code> or <code class="docutils literal notranslate"><span class="pre">.load()</span></code> when you want your result as a <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code> with data stored as NumPy arrays.</p>
<p>If you started <code class="docutils literal notranslate"><span class="pre">Client()</span></code> above then you may want to watch the status page during computation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">computed_da</span> <span class="o">=</span> <span class="n">da3</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="nb">type</span><span class="p">(</span><span class="n">computed_da</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>numpy.ndarray
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">computed_da</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray &#39;air&#39; (time: 2920, lat: 25, lon: 53, month: 12)&gt;
array([[[[-5.14987183e+00, -5.47715759e+00, -9.83168030e+00, ...,
          -2.06136017e+01, -1.25448456e+01, -6.77099609e+00],
         [-3.88607788e+00, -3.90576172e+00, -8.17987061e+00, ...,
          -1.87125549e+01, -1.11448669e+01, -5.52117920e+00],
         [-2.71517944e+00, -2.44839478e+00, -6.68945312e+00, ...,
          -1.70036011e+01, -9.99716187e+00, -4.41302490e+00],
         ...,
         [-1.02611389e+01, -9.05839539e+00, -9.39399719e+00, ...,
          -1.53933716e+01, -1.01606750e+01, -6.97190857e+00],
         [-8.58795166e+00, -7.50210571e+00, -7.61483765e+00, ...,
          -1.35699463e+01, -8.43449402e+00, -5.52383423e+00],
         [-7.04670715e+00, -5.84384155e+00, -5.70956421e+00, ...,
          -1.18162537e+01, -6.54209900e+00, -4.02824402e+00]],

        [[-5.05761719e+00, -4.00010681e+00, -9.17195129e+00, ...,
          -2.52222595e+01, -1.53296814e+01, -5.93362427e+00],
         [-4.40733337e+00, -3.25991821e+00, -8.36616516e+00, ...,
          -2.44294434e+01, -1.41292725e+01, -5.66036987e+00],
         [-4.01040649e+00, -2.77757263e+00, -7.87347412e+00, ...,
          -2.40147858e+01, -1.34914398e+01, -5.78581238e+00],
         ...,
         [-8.72866821e+00, -7.84707642e+00, -8.81103516e+00, ...,
          -1.36155548e+01, -9.04922485e+00, -5.98965454e+00],
         [-8.20866394e+00, -6.96633911e+00, -7.72509766e+00, ...,
          -1.28683472e+01, -7.77966309e+00, -5.66470337e+00],
         [-7.45472717e+00, -5.76663208e+00, -6.08197021e+00, ...,
          -1.18489838e+01, -6.16625977e+00, -4.81626892e+00]],

        [[-1.57711792e+00,  9.29214478e-01, -4.46768188e+00, ...,
          -1.96401672e+01, -1.10422668e+01, -2.02960205e+00],
         [-1.39662170e+00,  1.22764587e+00, -4.29142761e+00, ...,
          -1.89958191e+01, -9.03536987e+00, -1.73136902e+00],
         [-1.82463074e+00,  9.47463989e-01, -4.74427795e+00, ...,
          -1.95648346e+01, -8.62193298e+00, -2.47628784e+00],
         ...,
         [-1.01989136e+01, -9.22874451e+00, -8.47184753e+00, ...,
          -1.28121490e+01, -9.18234253e+00, -4.87542725e+00],
         [-1.03946228e+01, -8.94348145e+00, -8.10664368e+00, ...,
          -1.32274017e+01, -8.74662781e+00, -5.52293396e+00],
         [-9.86572266e+00, -8.02273560e+00, -7.04258728e+00, ...,
          -1.29959869e+01, -7.82368469e+00, -5.36987305e+00]],

        ...,

        [[ 7.49725342e-01,  6.71142578e-01,  9.43481445e-01, ...,
          -2.49722290e+00, -1.24258423e+00, -1.65069580e-01],
         [ 9.55932617e-01,  7.82104492e-01,  9.54162598e-01, ...,
          -2.10467529e+00, -9.40612793e-01,  2.23297119e-01],
         [ 1.17315674e+00,  1.23397827e+00,  1.17535400e+00, ...,
          -1.59451294e+00, -5.87738037e-01,  5.10772705e-01],
         ...,
         [ 2.13745117e-01,  9.55688477e-01,  6.33697510e-01, ...,
          -3.69454956e+00, -2.56884766e+00, -1.05606079e+00],
         [ 4.42932129e-01,  1.31857300e+00,  9.35882568e-01, ...,
          -3.59548950e+00, -2.46887207e+00, -9.91363525e-01],
         [ 6.51489258e-01,  1.51733398e+00,  1.02706909e+00, ...,
          -3.59484863e+00, -2.46112061e+00, -9.57580566e-01]],

        [[-6.44592285e-01, -8.87542725e-01, -8.02947998e-01, ...,
          -3.53155518e+00, -2.68783569e+00, -1.56814575e+00],
         [-2.69836426e-01, -4.34448242e-01, -4.87579346e-01, ...,
          -3.03854370e+00, -2.22027588e+00, -1.18026733e+00],
         [ 6.30065918e-01,  6.32934570e-01,  4.07623291e-01, ...,
          -1.94747925e+00, -1.17895508e+00, -2.54272461e-01],
         ...,
         [ 5.44067383e-01,  1.38833618e+00,  1.04916382e+00, ...,
          -3.35891724e+00, -2.26412964e+00, -9.55596924e-01],
         [ 8.18786621e-01,  1.68218994e+00,  1.32965088e+00, ...,
          -3.38873291e+00, -2.29397583e+00, -9.46685791e-01],
         [ 6.69921875e-01,  1.49740601e+00,  1.04785156e+00, ...,
          -3.83630371e+00, -2.70831299e+00, -1.32135010e+00]],

        [[-8.64166260e-01, -9.98901367e-01, -1.09173584e+00, ...,
          -3.08053589e+00, -2.52142334e+00, -1.59088135e+00],
         [-4.48303223e-01, -4.26483154e-01, -6.73095703e-01, ...,
          -2.63461304e+00, -2.06658936e+00, -1.19677734e+00],
         [ 5.10864258e-02,  2.42034912e-01, -1.26678467e-01, ...,
          -2.05606079e+00, -1.52102661e+00, -6.75537109e-01],
         ...,
         [ 8.82019043e-01,  1.73941040e+00,  1.56509399e+00, ...,
          -2.82403564e+00, -1.82955933e+00, -7.00347900e-01],
         [ 1.01446533e+00,  1.83419800e+00,  1.67877197e+00, ...,
          -2.87310791e+00, -1.96188354e+00, -7.75482178e-01],
         [ 9.63531494e-01,  1.72033691e+00,  1.58346558e+00, ...,
          -3.16232300e+00, -2.21890259e+00, -9.37622070e-01]]],


       [[[-4.24987793e+00, -4.57716370e+00, -8.93168640e+00, ...,
          -1.97136078e+01, -1.16448517e+01, -5.87100220e+00],
         [-3.68608093e+00, -3.70576477e+00, -7.97987366e+00, ...,
          -1.85125580e+01, -1.09448700e+01, -5.32118225e+00],
         [-3.11518860e+00, -2.84840393e+00, -7.08946228e+00, ...,
          -1.74036102e+01, -1.03971710e+01, -4.81303406e+00],
         ...,
         [-1.10611267e+01, -9.85838318e+00, -1.01939850e+01, ...,
          -1.61933594e+01, -1.09606628e+01, -7.77189636e+00],
         [-1.04879608e+01, -9.40211487e+00, -9.51484680e+00, ...,
          -1.54699554e+01, -1.03345032e+01, -7.42384338e+00],
         [-9.84671021e+00, -8.64384460e+00, -8.50956726e+00, ...,
          -1.46162567e+01, -9.34210205e+00, -6.82824707e+00]],

        [[-5.25761414e+00, -4.20010376e+00, -9.37194824e+00, ...,
          -2.54222565e+01, -1.55296783e+01, -6.13362122e+00],
         [-4.80734253e+00, -3.65992737e+00, -8.76617432e+00, ...,
          -2.48294525e+01, -1.45292816e+01, -6.06037903e+00],
         [-4.51040649e+00, -3.27757263e+00, -8.37347412e+00, ...,
          -2.45147858e+01, -1.39914398e+01, -6.28581238e+00],
         ...,
         [-1.05286560e+01, -9.64706421e+00, -1.06110229e+01, ...,
          -1.54155426e+01, -1.08492126e+01, -7.78964233e+00],
         [-1.10086517e+01, -9.76632690e+00, -1.05250854e+01, ...,
          -1.56683350e+01, -1.05796509e+01, -8.46469116e+00],
         [-1.10547180e+01, -9.36662292e+00, -9.68196106e+00, ...,
          -1.54489746e+01, -9.76625061e+00, -8.41625977e+00]],

        [[ 1.62287903e+00,  4.12921143e+00, -1.26768494e+00, ...,
          -1.64401703e+01, -7.84226990e+00,  1.17039490e+00],
         [ 1.69338989e+00,  4.31765747e+00, -1.20141602e+00, ...,
          -1.59058075e+01, -5.94535828e+00,  1.35864258e+00],
         [ 1.38536072e+00,  4.15745544e+00, -1.53428650e+00, ...,
          -1.63548431e+01, -5.41194153e+00,  7.33703613e-01],
         ...,
         [-1.25989227e+01, -1.16287537e+01, -1.08718567e+01, ...,
          -1.52121582e+01, -1.15823517e+01, -7.27543640e+00],
         [-1.33946228e+01, -1.19434814e+01, -1.11066437e+01, ...,
          -1.62274017e+01, -1.17466278e+01, -8.52293396e+00],
         [-1.30657196e+01, -1.12227325e+01, -1.02425842e+01, ...,
          -1.61959839e+01, -1.10236816e+01, -8.56987000e+00]],

        ...,

        [[ 5.49713135e-01,  4.71130371e-01,  7.43469238e-01, ...,
          -2.69723511e+00, -1.44259644e+00, -3.65081787e-01],
         [ 6.55944824e-01,  4.82116699e-01,  6.54174805e-01, ...,
          -2.40466309e+00, -1.24060059e+00, -7.66906738e-02],
         [ 9.73144531e-01,  1.03396606e+00,  9.75341797e-01, ...,
          -1.79452515e+00, -7.87750244e-01,  3.10760498e-01],
         ...,
         [ 2.13745117e-01,  9.55688477e-01,  6.33697510e-01, ...,
          -3.69454956e+00, -2.56884766e+00, -1.05606079e+00],
         [ 4.42932129e-01,  1.31857300e+00,  9.35882568e-01, ...,
          -3.59548950e+00, -2.46887207e+00, -9.91363525e-01],
         [ 7.41516113e-01,  1.60736084e+00,  1.11709595e+00, ...,
          -3.50482178e+00, -2.37109375e+00, -8.67553711e-01]],

        [[-3.44604492e-01, -5.87554932e-01, -5.02960205e-01, ...,
          -3.23156738e+00, -2.38784790e+00, -1.26815796e+00],
         [ 2.30163574e-01,  6.55517578e-02,  1.24206543e-02, ...,
          -2.53854370e+00, -1.72027588e+00, -6.80267334e-01],
         [ 6.30065918e-01,  6.32934570e-01,  4.07623291e-01, ...,
          -1.94747925e+00, -1.17895508e+00, -2.54272461e-01],
         ...,
         [ 2.44079590e-01,  1.08834839e+00,  7.49176025e-01, ...,
          -3.65890503e+00, -2.56411743e+00, -1.25558472e+00],
         [ 4.18792725e-01,  1.28219604e+00,  9.29656982e-01, ...,
          -3.78872681e+00, -2.69396973e+00, -1.34667969e+00],
         [ 5.69946289e-01,  1.39743042e+00,  9.47875977e-01, ...,
          -3.93627930e+00, -2.80828857e+00, -1.42132568e+00]],

        [[-8.64166260e-01, -9.98901367e-01, -1.09173584e+00, ...,
          -3.08053589e+00, -2.52142334e+00, -1.59088135e+00],
         [-3.83300781e-02, -1.65100098e-02, -2.63122559e-01, ...,
          -2.22463989e+00, -1.65661621e+00, -7.86804199e-01],
         [ 3.51074219e-01,  5.42022705e-01,  1.73309326e-01, ...,
          -1.75607300e+00, -1.22103882e+00, -3.75549316e-01],
         ...,
         [ 3.82019043e-01,  1.23941040e+00,  1.06509399e+00, ...,
          -3.32403564e+00, -2.32955933e+00, -1.20034790e+00],
         [ 6.24450684e-01,  1.44418335e+00,  1.28875732e+00, ...,
          -3.26312256e+00, -2.35189819e+00, -1.16549683e+00],
         [ 9.63531494e-01,  1.72033691e+00,  1.58346558e+00, ...,
          -3.16232300e+00, -2.21890259e+00, -9.37622070e-01]]],


       [[[-4.04988098e+00, -4.37716675e+00, -8.73168945e+00, ...,
          -1.95136108e+01, -1.14448547e+01, -5.67100525e+00],
         [-4.18608093e+00, -4.20576477e+00, -8.47987366e+00, ...,
          -1.90125580e+01, -1.14448700e+01, -5.82118225e+00],
         [-3.91519165e+00, -3.64840698e+00, -7.88946533e+00, ...,
          -1.82036133e+01, -1.11971741e+01, -5.61303711e+00],
         ...,
         [-8.76113892e+00, -7.55839539e+00, -7.89399719e+00, ...,
          -1.38933716e+01, -8.66067505e+00, -5.47190857e+00],
         [-7.98796082e+00, -6.90211487e+00, -7.01484680e+00, ...,
          -1.29699554e+01, -7.83450317e+00, -4.92384338e+00],
         [-6.94670105e+00, -5.74383545e+00, -5.60955811e+00, ...,
          -1.17162476e+01, -6.44209290e+00, -3.92823792e+00]],

        [[-4.25761414e+00, -3.20010376e+00, -8.37194824e+00, ...,
          -2.44222565e+01, -1.45296783e+01, -5.13362122e+00],
         [-4.51733398e+00, -3.36991882e+00, -8.47616577e+00, ...,
          -2.45394440e+01, -1.42392731e+01, -5.77037048e+00],
         [-4.71040344e+00, -3.47756958e+00, -8.57347107e+00, ...,
          -2.47147827e+01, -1.41914368e+01, -6.48580933e+00],
         ...,
         [-1.12286682e+01, -1.03470764e+01, -1.13110352e+01, ...,
          -1.61155548e+01, -1.15492249e+01, -8.48965454e+00],
         [-1.15086517e+01, -1.02663269e+01, -1.10250854e+01, ...,
          -1.61683350e+01, -1.10796509e+01, -8.96469116e+00],
         [-1.10547180e+01, -9.36662292e+00, -9.68196106e+00, ...,
          -1.54489746e+01, -9.76625061e+00, -8.41625977e+00]],

        [[ 4.62286377e+00,  7.12919617e+00,  1.73229980e+00, ...,
          -1.34401855e+01, -4.84228516e+00,  4.17037964e+00],
         [ 4.30339050e+00,  6.92765808e+00,  1.40858459e+00, ...,
          -1.32958069e+01, -3.33535767e+00,  3.96864319e+00],
         [ 3.48536682e+00,  6.25746155e+00,  5.65719604e-01, ...,
          -1.42548370e+01, -3.31193542e+00,  2.83370972e+00],
         ...,
         [-1.21989136e+01, -1.12287445e+01, -1.04718475e+01, ...,
          -1.48121490e+01, -1.11823425e+01, -6.87542725e+00],
         [-1.35846252e+01, -1.21334839e+01, -1.12966461e+01, ...,
          -1.64174042e+01, -1.19366302e+01, -8.71293640e+00],
         [-1.33657227e+01, -1.15227356e+01, -1.05425873e+01, ...,
          -1.64959869e+01, -1.13236847e+01, -8.86987305e+00]],

        ...,

        [[-2.50274658e-01, -3.28857422e-01, -5.65185547e-02, ...,
          -3.49722290e+00, -2.24258423e+00, -1.16506958e+00],
         [ 1.55944824e-01, -1.78833008e-02,  1.54174805e-01, ...,
          -2.90466309e+00, -1.74060059e+00, -5.76690674e-01],
         [ 1.73156738e-01,  2.33978271e-01,  1.75354004e-01, ...,
          -2.59451294e+00, -1.58773804e+00, -4.89227295e-01],
         ...,
         [ 1.10375977e+00,  1.84570312e+00,  1.52371216e+00, ...,
          -2.80453491e+00, -1.67883301e+00, -1.66046143e-01],
         [ 6.32934570e-01,  1.50857544e+00,  1.12588501e+00, ...,
          -3.40548706e+00, -2.27886963e+00, -8.01361084e-01],
         [ 9.51507568e-01,  1.81735229e+00,  1.32708740e+00, ...,
          -3.29483032e+00, -2.16110229e+00, -6.57562256e-01]],

        [[-3.44604492e-01, -5.87554932e-01, -5.02960205e-01, ...,
          -3.23156738e+00, -2.38784790e+00, -1.26815796e+00],
         [ 3.01818848e-02, -1.34429932e-01, -1.87561035e-01, ...,
          -2.73852539e+00, -1.92025757e+00, -8.80249023e-01],
         [ 1.30065918e-01,  1.32934570e-01, -9.23767090e-02, ...,
          -2.44747925e+00, -1.67895508e+00, -7.54272461e-01],
         ...,
         [ 1.04406738e+00,  1.88833618e+00,  1.54916382e+00, ...,
          -2.85891724e+00, -1.76412964e+00, -4.55596924e-01],
         [ 9.18792725e-01,  1.78219604e+00,  1.42965698e+00, ...,
          -3.28872681e+00, -2.19396973e+00, -8.46679688e-01],
         [ 1.06994629e+00,  1.89743042e+00,  1.44787598e+00, ...,
          -3.43627930e+00, -2.30828857e+00, -9.21325684e-01]],

        [[-7.54180908e-01, -8.88916016e-01, -9.81750488e-01, ...,
          -2.97055054e+00, -2.41143799e+00, -1.48089600e+00],
         [-9.48303223e-01, -9.26483154e-01, -1.17309570e+00, ...,
          -3.13461304e+00, -2.56658936e+00, -1.69677734e+00],
         [-6.48925781e-01, -4.57977295e-01, -8.26690674e-01, ...,
          -2.75607300e+00, -2.22103882e+00, -1.37554932e+00],
         ...,
         [ 9.82025146e-01,  1.83941650e+00,  1.66510010e+00, ...,
          -2.72402954e+00, -1.72955322e+00, -6.00341797e-01],
         [ 1.22445679e+00,  2.04418945e+00,  1.88876343e+00, ...,
          -2.66311646e+00, -1.75189209e+00, -5.65490723e-01],
         [ 1.15353394e+00,  1.91033936e+00,  1.77346802e+00, ...,
          -2.97232056e+00, -2.02890015e+00, -7.47619629e-01]]],


       ...,


       [[[-2.85987854e+00, -3.18716431e+00, -7.54168701e+00, ...,
          -1.83236084e+01, -1.02548523e+01, -4.48100281e+00],
         [-3.39608765e+00, -3.41577148e+00, -7.68988037e+00, ...,
          -1.82225647e+01, -1.06548767e+01, -5.03118896e+00],
         [-4.12518311e+00, -3.85839844e+00, -8.09945679e+00, ...,
          -1.84136047e+01, -1.14071655e+01, -5.82302856e+00],
         ...,
         [ 1.12886047e+00,  2.33160400e+00,  1.99600220e+00, ...,
          -4.00337219e+00,  1.22932434e+00,  4.41809082e+00],
         [ 4.02038574e-01,  1.48788452e+00,  1.37515259e+00, ...,
          -4.57995605e+00,  5.55496216e-01,  3.46615601e+00],
         [-7.56698608e-01,  4.46166992e-01,  5.80444336e-01, ...,
          -5.52624512e+00, -2.52090454e-01,  2.26176453e+00]],

        [[ 2.32391357e-01,  1.28990173e+00, -3.88194275e+00, ...,
          -1.99322510e+01, -1.00396729e+01, -6.43615723e-01],
         [ 8.26568604e-02,  1.23007202e+00, -3.87617493e+00, ...,
          -1.99394531e+01, -9.63928223e+00, -1.17037964e+00],
         [-1.20407104e-01,  1.11242676e+00, -3.98347473e+00, ...,
          -2.01247864e+01, -9.60144043e+00, -1.89581299e+00],
         ...,
         [-9.38659668e-01, -5.70678711e-02, -1.02102661e+00, ...,
          -5.82554626e+00, -1.25921631e+00,  1.80035400e+00],
         [-2.21865845e+00, -9.76333618e-01, -1.73509216e+00, ...,
          -6.87834167e+00, -1.78965759e+00,  3.25302124e-01],
         [-4.06472778e+00, -2.37663269e+00, -2.69197083e+00, ...,
          -8.45898438e+00, -2.77626038e+00, -1.42626953e+00]],

        [[ 1.11128845e+01,  1.36192169e+01,  8.22232056e+00, ...,
          -6.95016479e+00,  1.64773560e+00,  1.06604004e+01],
         [ 1.09933929e+01,  1.36176605e+01,  8.09858704e+00, ...,
          -6.60580444e+00,  3.35464478e+00,  1.06586456e+01],
         [ 1.09753723e+01,  1.37474670e+01,  8.05572510e+00, ...,
          -6.76483154e+00,  4.17807007e+00,  1.03237152e+01],
         ...,
         [-4.00891113e+00, -3.03874207e+00, -2.28184509e+00, ...,
          -6.62214661e+00, -2.99234009e+00,  1.31457520e+00],
         [-5.09463501e+00, -3.64349365e+00, -2.80665588e+00, ...,
          -7.92741394e+00, -3.44664001e+00, -2.22946167e-01],
         [-6.37573242e+00, -4.53274536e+00, -3.55259705e+00, ...,
          -9.50599670e+00, -4.33369446e+00, -1.87988281e+00]],

        ...,

        [[-1.06027222e+00, -1.13885498e+00, -8.66516113e-01, ...,
          -4.30722046e+00, -3.05258179e+00, -1.97506714e+00],
         [ 4.59594727e-02, -1.27868652e-01,  4.41894531e-02, ...,
          -3.01464844e+00, -1.85058594e+00, -6.86676025e-01],
         [ 2.26315308e+00,  2.32397461e+00,  2.26535034e+00, ...,
          -5.04516602e-01,  5.02258301e-01,  1.60076904e+00],
         ...,
         [ 3.03741455e-01,  1.04568481e+00,  7.23693848e-01, ...,
          -3.60455322e+00, -2.47885132e+00, -9.66064453e-01],
         [ 7.32910156e-01,  1.60855103e+00,  1.22586060e+00, ...,
          -3.30551147e+00, -2.17889404e+00, -7.01385498e-01],
         [ 6.41510010e-01,  1.50735474e+00,  1.01708984e+00, ...,
          -3.60482788e+00, -2.47109985e+00, -9.67559814e-01]],

        [[ 2.45422363e-01,  2.47192383e-03,  8.70666504e-02, ...,
          -2.64154053e+00, -1.79782104e+00, -6.78131104e-01],
         [ 1.42016602e+00,  1.25555420e+00,  1.20242310e+00, ...,
          -1.34854126e+00, -5.30273438e-01,  5.09735107e-01],
         [ 2.13006592e+00,  2.13293457e+00,  1.90762329e+00, ...,
          -4.47479248e-01,  3.21044922e-01,  1.24572754e+00],
         ...,
         [ 1.34063721e-01,  9.78332520e-01,  6.39160156e-01, ...,
          -3.76892090e+00, -2.67413330e+00, -1.36560059e+00],
         [ 4.08782959e-01,  1.27218628e+00,  9.19647217e-01, ...,
          -3.79873657e+00, -2.70397949e+00, -1.35668945e+00],
         [ 2.59948730e-01,  1.08743286e+00,  6.37878418e-01, ...,
          -4.24627686e+00, -3.11828613e+00, -1.73132324e+00]],

        [[ 1.03582764e+00,  9.01092529e-01,  8.08258057e-01, ...,
          -1.18054199e+00, -6.21429443e-01,  3.09112549e-01],
         [ 1.95169067e+00,  1.97351074e+00,  1.72689819e+00, ...,
          -2.34619141e-01,  3.33404541e-01,  1.20321655e+00],
         [ 1.74108887e+00,  1.93203735e+00,  1.56332397e+00, ...,
          -3.66058350e-01,  1.68975830e-01,  1.01446533e+00],
         ...,
         [ 7.20214844e-02,  9.29412842e-01,  7.55096436e-01, ...,
          -3.63403320e+00, -2.63955688e+00, -1.51034546e+00],
         [ 1.44653320e-02,  8.34197998e-01,  6.78771973e-01, ...,
          -3.87310791e+00, -2.96188354e+00, -1.77548218e+00],
         [ 1.53533936e-01,  9.10339355e-01,  7.73468018e-01, ...,
          -3.97232056e+00, -3.02890015e+00, -1.74761963e+00]]],


       [[[-5.59875488e-01, -8.87161255e-01, -5.24168396e+00, ...,
          -1.60236053e+01, -7.95484924e+00, -2.18099976e+00],
         [-1.59608459e+00, -1.61576843e+00, -5.88987732e+00, ...,
          -1.64225616e+01, -8.85487366e+00, -3.23118591e+00],
         [-2.72518921e+00, -2.45840454e+00, -6.69946289e+00, ...,
          -1.70136108e+01, -1.00071716e+01, -4.42303467e+00],
         ...,
         [ 2.28866577e-01,  1.43161011e+00,  1.09600830e+00, ...,
          -4.90336609e+00,  3.29330444e-01,  3.51809692e+00],
         [-9.79614258e-02,  9.87884521e-01,  8.75152588e-01, ...,
          -5.07995605e+00,  5.54962158e-02,  2.96615601e+00],
         [-8.56704712e-01,  3.46160889e-01,  4.80438232e-01, ...,
          -5.62625122e+00, -3.52096558e-01,  2.16175842e+00]],

        [[ 1.03239441e+00,  2.08990479e+00, -3.08193970e+00, ...,
          -1.91322479e+01, -9.23966980e+00,  1.56387329e-01],
         [ 3.82659912e-01,  1.53007507e+00, -3.57617188e+00, ...,
          -1.96394501e+01, -9.33927917e+00, -8.70376587e-01],
         [-2.20413208e-01,  1.01242065e+00, -4.08348083e+00, ...,
          -2.02247925e+01, -9.70144653e+00, -1.99581909e+00],
         ...,
         [-2.38662720e-01,  6.42929077e-01, -3.21029663e-01, ...,
          -5.12554932e+00, -5.59219360e-01,  2.50035095e+00],
         [-1.01866150e+00,  2.23663330e-01, -5.35095215e-01, ...,
          -5.67834473e+00, -5.89660645e-01,  1.52529907e+00],
         [-2.46472168e+00, -7.76626587e-01, -1.09196472e+00, ...,
          -6.85897827e+00, -1.17625427e+00,  1.73736572e-01]],

        [[ 1.08128662e+01,  1.33191986e+01,  7.92230225e+00, ...,
          -7.25018311e+00,  1.34771729e+00,  1.03603821e+01],
         [ 1.05933990e+01,  1.32176666e+01,  7.69859314e+00, ...,
          -7.00579834e+00,  2.95465088e+00,  1.02586517e+01],
         [ 1.05753784e+01,  1.33474731e+01,  7.65573120e+00, ...,
          -7.16482544e+00,  3.77807617e+00,  9.92372131e+00],
         ...,
         [-2.90892029e+00, -1.93875122e+00, -1.18185425e+00, ...,
          -5.52215576e+00, -1.89234924e+00,  2.41456604e+00],
         [-3.69462585e+00, -2.24348450e+00, -1.40664673e+00, ...,
          -6.52740479e+00, -2.04663086e+00,  1.17706299e+00],
         [-4.67572021e+00, -2.83273315e+00, -1.85258484e+00, ...,
          -7.80598450e+00, -2.63368225e+00, -1.79870605e-01]],

        ...,

        [[-2.16027832e+00, -2.23886108e+00, -1.96652222e+00, ...,
          -5.40722656e+00, -4.15258789e+00, -3.07507324e+00],
         [-1.35406494e+00, -1.52789307e+00, -1.35583496e+00, ...,
          -4.41467285e+00, -3.25061035e+00, -2.08670044e+00],
         [ 1.63146973e-01,  2.23968506e-01,  1.65344238e-01, ...,
          -2.60452271e+00, -1.59774780e+00, -4.99237061e-01],
         ...,
         [-9.62524414e-02,  6.45690918e-01,  3.23699951e-01, ...,
          -4.00454712e+00, -2.87884521e+00, -1.36605835e+00],
         [ 3.29284668e-02,  9.08569336e-01,  5.25878906e-01, ...,
          -4.00549316e+00, -2.87887573e+00, -1.40136719e+00],
         [ 2.41516113e-01,  1.10736084e+00,  6.17095947e-01, ...,
          -4.00482178e+00, -2.87109375e+00, -1.36755371e+00]],

        [[-2.54577637e-01, -4.97528076e-01, -4.12933350e-01, ...,
          -3.14154053e+00, -2.29782104e+00, -1.17813110e+00],
         [ 7.20184326e-01,  5.55572510e-01,  5.02441406e-01, ...,
          -2.04852295e+00, -1.23025513e+00, -1.90246582e-01],
         [ 1.43005371e+00,  1.43292236e+00,  1.20761108e+00, ...,
          -1.14749146e+00, -3.78967285e-01,  5.45715332e-01],
         ...,
         [-6.59179688e-02,  7.78350830e-01,  4.39178467e-01, ...,
          -3.96890259e+00, -2.87411499e+00, -1.56558228e+00],
         [ 8.78906250e-03,  8.72192383e-01,  5.19653320e-01, ...,
          -4.19873047e+00, -3.10397339e+00, -1.75668335e+00],
         [-1.40075684e-01,  6.87408447e-01,  2.37854004e-01, ...,
          -4.64630127e+00, -3.51831055e+00, -2.13134766e+00]],

        [[ 6.35833740e-01,  5.01098633e-01,  4.08264160e-01, ...,
          -1.58053589e+00, -1.02142334e+00, -9.08813477e-02],
         [ 1.15167236e+00,  1.17349243e+00,  9.26879883e-01, ...,
          -1.03463745e+00, -4.66613770e-01,  4.03198242e-01],
         [ 1.44107056e+00,  1.63201904e+00,  1.26330566e+00, ...,
          -6.66076660e-01, -1.31042480e-01,  7.14447021e-01],
         ...,
         [-3.27972412e-01,  5.29418945e-01,  3.55102539e-01, ...,
          -4.03402710e+00, -3.03955078e+00, -1.91033936e+00],
         [-2.85552979e-01,  5.34179688e-01,  3.78753662e-01, ...,
          -4.17312622e+00, -3.26190186e+00, -2.07550049e+00],
         [-4.46472168e-01,  3.10333252e-01,  1.73461914e-01, ...,
          -4.57232666e+00, -3.62890625e+00, -2.34762573e+00]]],


       [[[-1.25987244e+00, -1.58715820e+00, -5.94168091e+00, ...,
          -1.67236023e+01, -8.65484619e+00, -2.88099670e+00],
         [-2.09608459e+00, -2.11576843e+00, -6.38987732e+00, ...,
          -1.69225616e+01, -9.35487366e+00, -3.73118591e+00],
         [-2.92518616e+00, -2.65840149e+00, -6.89945984e+00, ...,
          -1.72136078e+01, -1.02071686e+01, -4.62303162e+00],
         ...,
         [-1.37113953e+00, -1.68395996e-01, -5.03997803e-01, ...,
          -6.50337219e+00, -1.27067566e+00,  1.91809082e+00],
         [-2.59796143e+00, -1.51211548e+00, -1.62484741e+00, ...,
          -7.57995605e+00, -2.44450378e+00,  4.66156006e-01],
         [-3.85670471e+00, -2.65383911e+00, -2.51956177e+00, ...,
          -8.62625122e+00, -3.35209656e+00, -8.38241577e-01]],

        [[ 1.03239441e+00,  2.08990479e+00, -3.08193970e+00, ...,
          -1.91322479e+01, -9.23966980e+00,  1.56387329e-01],
         [ 3.82659912e-01,  1.53007507e+00, -3.57617188e+00, ...,
          -1.96394501e+01, -9.33927917e+00, -8.70376587e-01],
         [-3.20404053e-01,  9.12429810e-01, -4.18347168e+00, ...,
          -2.03247833e+01, -9.80143738e+00, -2.09580994e+00],
         ...,
         [-1.93865967e+00, -1.05706787e+00, -2.02102661e+00, ...,
          -6.82554626e+00, -2.25921631e+00,  8.00354004e-01],
         [-3.21865845e+00, -1.97633362e+00, -2.73509216e+00, ...,
          -7.87834167e+00, -2.78965759e+00, -6.74697876e-01],
         [-5.06472778e+00, -3.37663269e+00, -3.69197083e+00, ...,
          -9.45898438e+00, -3.77626038e+00, -2.42626953e+00]],

        [[ 1.14128723e+01,  1.39192047e+01,  8.52230835e+00, ...,
          -6.65017700e+00,  1.94772339e+00,  1.09603882e+01],
         [ 1.09933929e+01,  1.36176605e+01,  8.09858704e+00, ...,
          -6.60580444e+00,  3.35464478e+00,  1.06586456e+01],
         [ 1.06753540e+01,  1.34474487e+01,  7.75570679e+00, ...,
          -7.06484985e+00,  3.87805176e+00,  1.00236969e+01],
         ...,
         [-3.50891113e+00, -2.53874207e+00, -1.78184509e+00, ...,
          -6.12214661e+00, -2.49234009e+00,  1.81457520e+00],
         [-4.19462585e+00, -2.74348450e+00, -1.90664673e+00, ...,
          -7.02740479e+00, -2.54663086e+00,  6.77062988e-01],
         [-5.27572632e+00, -3.43273926e+00, -2.45259094e+00, ...,
          -8.40599060e+00, -3.23368835e+00, -7.79876709e-01]],

        ...,

        [[-2.06027222e+00, -2.13885498e+00, -1.86651611e+00, ...,
          -5.30722046e+00, -4.05258179e+00, -2.97506714e+00],
         [-1.55404663e+00, -1.72787476e+00, -1.55581665e+00, ...,
          -4.61465454e+00, -3.45059204e+00, -2.28668213e+00],
         [-1.36840820e-01, -7.60192871e-02, -1.34643555e-01, ...,
          -2.90451050e+00, -1.89773560e+00, -7.99224854e-01],
         ...,
         [ 1.03759766e-01,  8.45703125e-01,  5.23712158e-01, ...,
          -3.80453491e+00, -2.67883301e+00, -1.16604614e+00],
         [ 4.32922363e-01,  1.30856323e+00,  9.25872803e-01, ...,
          -3.60549927e+00, -2.47888184e+00, -1.00137329e+00],
         [ 6.41510010e-01,  1.50735474e+00,  1.01708984e+00, ...,
          -3.60482788e+00, -2.47109985e+00, -9.67559814e-01]],

        [[-4.54589844e-01, -6.97540283e-01, -6.12945557e-01, ...,
          -3.34155273e+00, -2.49783325e+00, -1.37814331e+00],
         [ 4.20166016e-01,  2.55554199e-01,  2.02423096e-01, ...,
          -2.34854126e+00, -1.53027344e+00, -4.90264893e-01],
         [ 1.03005981e+00,  1.03292847e+00,  8.07617188e-01, ...,
          -1.54748535e+00, -7.78961182e-01,  1.45721436e-01],
         ...,
         [ 3.34075928e-01,  1.17834473e+00,  8.39172363e-01, ...,
          -3.56890869e+00, -2.47412109e+00, -1.16558838e+00],
         [ 6.08795166e-01,  1.47219849e+00,  1.11965942e+00, ...,
          -3.59872437e+00, -2.50396729e+00, -1.15667725e+00],
         [ 6.59942627e-01,  1.48742676e+00,  1.03787231e+00, ...,
          -3.84628296e+00, -2.71829224e+00, -1.33132935e+00]],

        [[ 5.35827637e-01,  4.01092529e-01,  3.08258057e-01, ...,
          -1.68054199e+00, -1.12142944e+00, -1.90887451e-01],
         [ 8.51684570e-01,  8.73504639e-01,  6.26892090e-01, ...,
          -1.33462524e+00, -7.66601562e-01,  1.03210449e-01],
         [ 1.04107666e+00,  1.23202515e+00,  8.63311768e-01, ...,
          -1.06607056e+00, -5.31036377e-01,  3.14453125e-01],
         ...,
         [ 4.72015381e-01,  1.32940674e+00,  1.15509033e+00, ...,
          -3.23403931e+00, -2.23956299e+00, -1.11035156e+00],
         [ 4.14459229e-01,  1.23419189e+00,  1.07876587e+00, ...,
          -3.47311401e+00, -2.56188965e+00, -1.37548828e+00],
         [ 5.35278320e-02,  8.10333252e-01,  6.73461914e-01, ...,
          -4.07232666e+00, -3.12890625e+00, -1.84762573e+00]]]],
      dtype=float32)
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
  * time     (time) datetime64[ns] 2013-01-01 ... 2014-12-31T18:00:00
  * month    (month) int64 1 2 3 4 5 6 7 8 9 10 11 12
</pre></div>
</div>
</div>
</div>
<div class="section" id="Persist-data-in-memory">
<h2>Persist data in memory<a class="headerlink" href="#Persist-data-in-memory" title="Permalink to this headline">¶</a></h2>
<p>If you have the available RAM for your dataset then you can persist data in memory.</p>
<p>This allows future computations to be much faster.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Time-Series-Operations">
<h2>Time Series Operations<a class="headerlink" href="#Time-Series-Operations" title="Permalink to this headline">¶</a></h2>
<p>Because we have a datetime index time-series operations work efficiently. Here we demo the use of xarray’s resample method:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">da</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray &#39;air&#39; (lat: 25, lon: 53)&gt;
dask.array&lt;sqrt, shape=(25, 53), dtype=float32, chunksize=(25, 25), chunktype=numpy.ndarray&gt;
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">da</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.QuadMesh at 0x7f73829390f0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/xarray_20_1.png" src="_images/xarray_20_1.png" />
</div>
</div>
<p>and rolling window operations:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">da_smooth</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
<span class="n">da_smooth</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
distributed.nanny - WARNING - Worker exceeded 95% memory budget. Restarting
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:38019&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:38019&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:38019&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)
NoneType: None
distributed.client - WARNING - Couldn&#39;t gather 3 keys, rescheduling {&#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:38019&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:38019&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:38019&#39;,)}
distributed.nanny - WARNING - Restarting worker
distributed.nanny - WARNING - Worker exceeded 95% memory budget. Restarting
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:45713&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:45713&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:45713&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:45713&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:45713&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:45713&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)
NoneType: None
distributed.client - WARNING - Couldn&#39;t gather 6 keys, rescheduling {&#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:45713&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:45713&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:45713&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:45713&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:45713&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:45713&#39;,)}
distributed.nanny - WARNING - Restarting worker
distributed.nanny - WARNING - Worker exceeded 95% memory budget. Restarting
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:44007&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:44007&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:44007&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:44007&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:44007&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:44007&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)
NoneType: None
distributed.client - WARNING - Couldn&#39;t gather 6 keys, rescheduling {&#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:44007&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:44007&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:44007&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:44007&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:44007&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:44007&#39;,)}
distributed.nanny - WARNING - Restarting worker
distributed.nanny - WARNING - Worker exceeded 95% memory budget. Restarting
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:46029&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:46029&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:46029&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:46029&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:46029&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:46029&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)
NoneType: None
distributed.client - WARNING - Couldn&#39;t gather 6 keys, rescheduling {&#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:46029&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:46029&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:46029&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:46029&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:46029&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:46029&#39;,)}
distributed.nanny - WARNING - Restarting worker
distributed.nanny - WARNING - Worker exceeded 95% memory budget. Restarting
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:34507&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:34507&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:34507&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:34507&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:34507&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)
NoneType: None
distributed.scheduler - ERROR - Workers don&#39;t have promised key: [&#39;tcp://127.0.0.1:34507&#39;], (&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)
NoneType: None
distributed.client - WARNING - Couldn&#39;t gather 6 keys, rescheduling {&#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:34507&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:34507&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:34507&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 1, 0)&#34;: (&#39;tcp://127.0.0.1:34507&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 0, 0, 2, 0)&#34;: (&#39;tcp://127.0.0.1:34507&#39;,), &#34;(&#39;getitem-131852822a83b17fc0fde2e749217e42&#39;, 1, 0, 0, 0)&#34;: (&#39;tcp://127.0.0.1:34507&#39;,)}
distributed.nanny - WARNING - Restarting worker
/home/travis/miniconda/envs/test/lib/python3.7/site-packages/distributed/worker.py:3235: UserWarning: Large object of size 15.48 MB detected in task graph:
  (array([[[241.2    , 242.5    , 243.5    , ..., 23 ... 50, 53, None)))
Consider scattering large objects ahead of time
with client.scatter to reduce scheduler burden and
keep data on workers

    future = client.submit(func, big_data)    # bad

    big_future = client.scatter(big_data)     # good
    future = client.submit(func, big_future)  # good
  % (format_bytes(len(b)), s)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray (time: 2920, lat: 25, lon: 53)&gt;
dask.array&lt;where, shape=(2920, 25, 53), dtype=float32, chunksize=(2905, 25, 25), chunktype=numpy.ndarray&gt;
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
  * time     (time) datetime64[ns] 2013-01-01 ... 2014-12-31T18:00:00
</pre></div>
</div>
</div>
<p>Since xarray stores each of its coordinate variables in memory, slicing by label is trivial and entirely lazy.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">time</span> da.sel(time=&#39;2013-01-01T18:00:00&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 1.46 ms, sys: 2.96 ms, total: 4.42 ms
Wall time: 4.05 ms
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray &#39;air&#39; (lat: 25, lon: 53)&gt;
dask.array&lt;getitem, shape=(25, 53), dtype=float32, chunksize=(25, 25), chunktype=numpy.ndarray&gt;
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
    time     datetime64[ns] 2013-01-01T18:00:00
Attributes:
    long_name:     4xDaily Air temperature at sigma level 995
    units:         degK
    precision:     2
    GRIB_id:       11
    GRIB_name:     TMP
    var_desc:      Air temperature
    dataset:       NMC Reanalysis
    level_desc:    Surface
    statistic:     Individual Obs
    parent_stat:   Other
    actual_range:  [185.16 322.1 ]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">time</span> da.sel(time=&#39;2013-01-01T18:00:00&#39;).load()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 88.9 ms, sys: 124 ms, total: 213 ms
Wall time: 293 ms
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray &#39;air&#39; (lat: 25, lon: 53)&gt;
array([[241.89   , 241.79999, 241.79999, ..., 234.39   , 235.5    ,
        237.59999],
       [246.29999, 245.29999, 244.2    , ..., 230.89   , 231.5    ,
        234.5    ],
       [256.6    , 254.7    , 252.09999, ..., 230.7    , 231.79999,
        236.09999],
       ...,
       [296.6    , 296.4    , 296.     , ..., 296.5    , 295.79   ,
        295.29   ],
       [297.     , 297.5    , 297.1    , ..., 296.79   , 296.6    ,
        296.29   ],
       [297.5    , 297.69998, 297.5    , ..., 297.79   , 298.     ,
        297.9    ]], dtype=float32)
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
    time     datetime64[ns] 2013-01-01T18:00:00
Attributes:
    long_name:     4xDaily Air temperature at sigma level 995
    units:         degK
    precision:     2
    GRIB_id:       11
    GRIB_name:     TMP
    var_desc:      Air temperature
    dataset:       NMC Reanalysis
    level_desc:    Surface
    statistic:     Individual Obs
    parent_stat:   Other
    actual_range:  [185.16 322.1 ]
</pre></div>
</div>
</div>
</div>
<div class="section" id="Custom-workflows-and-automatic-parallelization">
<h2>Custom workflows and automatic parallelization<a class="headerlink" href="#Custom-workflows-and-automatic-parallelization" title="Permalink to this headline">¶</a></h2>
<p>Almost all of xarray’s built-in operations work on Dask arrays. If you want to use a function that isn’t wrapped by xarray, one option is to extract Dask arrays from xarray objects (.data) and use Dask directly.</p>
<p>Another option is to use xarray’s <code class="docutils literal notranslate"><span class="pre">apply_ufunc()</span></code> function, which can automate embarrassingly parallel “map” type operations where a functions written for processing NumPy arrays should be repeatedly applied to xarray objects containing Dask arrays. It works similarly to <code class="docutils literal notranslate"><span class="pre">dask.array.map_blocks()</span></code> and <code class="docutils literal notranslate"><span class="pre">dask.array.atop()</span></code>, but without requiring an intermediate layer of abstraction.</p>
<p>Here we show an example using NumPy operations and a fast function from <code class="docutils literal notranslate"><span class="pre">bottleneck</span></code>, which we use to calculate Spearman’s rank-correlation coefficient:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">bottleneck</span>

<span class="k">def</span> <span class="nf">covariance_gufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pearson_correlation_gufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">covariance_gufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">spearman_correlation_gufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">x_ranks</span> <span class="o">=</span> <span class="n">bottleneck</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_ranks</span> <span class="o">=</span> <span class="n">bottleneck</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pearson_correlation_gufunc</span><span class="p">(</span><span class="n">x_ranks</span><span class="p">,</span> <span class="n">y_ranks</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">spearman_correlation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">apply_ufunc</span><span class="p">(</span>
        <span class="n">spearman_correlation_gufunc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
        <span class="n">input_core_dims</span><span class="o">=</span><span class="p">[[</span><span class="n">dim</span><span class="p">],</span> <span class="p">[</span><span class="n">dim</span><span class="p">]],</span>
        <span class="n">dask</span><span class="o">=</span><span class="s1">&#39;parallelized&#39;</span><span class="p">,</span>
        <span class="n">output_dtypes</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>In the examples above, we were working with an some air temperature data. For this example, we’ll calculate the spearman correlation using the raw air temperature data with the smoothed version that we also created (<code class="docutils literal notranslate"><span class="pre">da_smooth</span></code>). For this, we’ll also have to rechunk the data ahead of time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">spearman_correlation</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}),</span>
                            <span class="n">da_smooth</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}),</span>
                            <span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">corr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.DataArray (lat: 25, lon: 53)&gt;
dask.array&lt;spearman_correlation_gufunc, shape=(25, 53), dtype=float64, chunksize=(25, 25), chunktype=numpy.ndarray&gt;
Coordinates:
  * lat      (lat) float32 75.0 72.5 70.0 67.5 65.0 ... 25.0 22.5 20.0 17.5 15.0
  * lon      (lon) float32 200.0 202.5 205.0 207.5 ... 322.5 325.0 327.5 330.0
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">corr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.QuadMesh at 0x7f73826aa160&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/xarray_31_1.png" src="_images/xarray_31_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-18218874-5', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dataframes/01-data-access.html" class="btn btn-neutral float-right" title="DataFrames: Read and Write Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="machine-learning.html" class="btn btn-neutral float-left" title="Dask for Machine Learning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Dask Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
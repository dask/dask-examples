

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Stencil Computations with Numba &mdash; Dask Examples  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/explore.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/nbsphinx.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
        <script src="../_static/js/custom.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Time Series Forecasting" href="forecasting-with-prophet.html" />
    <link rel="prev" title="Reading and manipulating tiled GeoTIFF datasets" href="satellite-imagery-geotiff.html" />
  <link rel="shortcut icon" href="../_static/images/favicon.ico"/>
  
  <meta name="Description" content="Stencil Computations with Numba">
  <meta property="og:description" content="Stencil Computations with Numba">
  <meta name="twitter:description" content="Stencil Computations with Numba" />
  <meta property="og:title" content="Dask Examples  documentation - Stencil Computations with Numba">
  <meta property="og:image" content="https://github.com/dask.png">
  <meta property="og:image:secure_url" content="https://github.com/dask.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="380" />
  <meta property="og:image:height" content="380" />
  <meta property="og:url" content="applications/stencils-with-numba.html">
  <meta property="og:site_name" content="Dask Examples  documentation">

  <meta name="twitter:site" content="https://dask.org" />
  <meta name="twitter:creator" content="@dask_dev" />
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://github.com/dask.png" />
  <meta name="twitter:image:alt" content="Dask Examples  documentation">


</head>

<body class="wy-body-for-nav">

  
    <nav id="explore-links">
        <a href="https://docs.dask.org/">
        <img class="caption" src="../_static/images/dask-horizontal-white.svg"/>
        </a>

        <ul>
        <li>
            <a>Get Started</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/install.html"> Install </a></li>
            <li><a href="https://examples.dask.org"> Examples </a></li>
            <li><a href="https://github.com/dask/dask-tutorial"> Tutorial </a></li>
            <li><a href="https://docs.dask.org/en/latest/why.html"> Why Dask? </a></li>
            <li><a href="https://stories.dask.org/en/latest"> Use Cases </a></li>
            <li><a href="https://www.youtube.com/watch?v=RA_2qdipVng&list=PLRtz5iA93T4PQvWuoMnIyEIz1fXiJ5Pri"> Talks </a></li>
            <li><a href="https://mybinder.org/v2/gh/dask/dask-examples/main?urlpath=lab"> Try Online </a></li>
            <li><a href="https://dask.org/slides"> Slides </a></li>
            </ul>
        </li>

        <li>
            <a href="">Algorithms</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/array.html">Arrays</a></li>
            <li><a href="https://docs.dask.org/en/latest/dataframe.html">Dataframes</a></li>
            <li><a href="https://docs.dask.org/en/latest/bag.html">Bags</a></li>
            <li><a href="https://docs.dask.org/en/latest/delayed.html">Delayed (custom)</a></li>
            <li><a href="https://docs.dask.org/en/latest/futures.html">Futures (real-time)</a></li>
            <li><a href="http://ml.dask.org">Machine Learning</a></li>
            <li><a href="https://xarray.pydata.org/en/latest/">XArray</a></li>
            </ul>
        </li>

        <li>
            <a href="https://docs.dask.org/en/latest/setup.html">Setup</a>
            <ul>
            <li><a href="https://docs.dask.org/en/latest/setup/single-machine.html"> Local </a></li>
            <li><a href="https://docs.dask.org/en/latest/setup/cloud.html"> Cloud </a></li>
            <li><a href="https://docs.dask.org/en/latest/setup/hpc.html"> HPC </a></li>
            <li><a href="https://kubernetes.dask.org/en/latest/"> Kubernetes </a></li>
            <li><a href="https://yarn.dask.org/en/latest/"> Hadoop / Yarn </a></li>
            </ul>
        </li>

        <li>
            <a>Community</a>
            <ul>
            <li><a href="http://docs.dask.org/en/latest/support.html">Ask for Help</a></li>
            <li><a href="https://github.com/dask">Github</a></li>
            <li><a href="https://stackoverflow.com/questions/tagged/dask">Stack Overflow</a></li>
            <li><a href="https://twitter.com/dask_dev">Twitter</a></li>
            <li><a href="https://blog.dask.org/"> Developer Blog </a></li>
            <li><a href="https://youtube.com/c/dask-dev"> YouTube Channel </a></li>
            <li><a href="https://join.slack.com/t/dask/shared_invite/zt-mfmh7quc-nIrXL6ocgiUH2haLYA914g"> Slack </a></li>
            </ul>
        </li>
        </ul>

    </nav>
  
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Dask Examples
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Basic Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../array.html">Dask Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bag.html">Dask Bags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataframe.html">Dask DataFrames</a></li>
<li class="toctree-l1"><a class="reference internal" href="../delayed.html">Custom Workloads with Dask Delayed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../futures.html">Custom Workloads with Futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning.html">Dask for Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xarray.html">Xarray with Dask Arrays</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dataframes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dataframes/01-data-access.html">DataFrames: Read and Write Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataframes/02-groupby.html">DataFrames: Groupby</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/blockwise-ensemble.html">Blockwise Ensemble Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/scale-scikit-learn.html">Scale Scikit-Learn for Small Data Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/parallel-prediction.html">Score and Predict Large Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/torch-prediction.html">Batch Prediction with PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/training-on-large-datasets.html">Train Models on Large Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/incremental.html">Incrementally Train Large Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/text-vectorization.html">Text Vectorization Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/hyperparam-opt.html">Hyperparameter optimization with Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/xgboost.html">Scale XGBoost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/voting-classifier.html">Use Voting Classifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/tpot.html">Automate Machine Learning with TPOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/glm.html">Generalized Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machine-learning/svd.html">Singular Value Decomposition</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="json-data-on-the-web.html">Analyze web-hosted JSON data</a></li>
<li class="toctree-l1"><a class="reference internal" href="async-await.html">Async/Await and Non-Blocking Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="async-web-server.html">Asynchronous Computation: Web Servers + Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="embarrassingly-parallel.html">Embarrassingly parallel Workloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="evolving-workflows.html">Handle Evolving Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-processing.html">Image Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="prefect-etl.html">ETL Pipelines with Prefect</a></li>
<li class="toctree-l1"><a class="reference internal" href="satellite-imagery-geotiff.html">Reading and manipulating tiled GeoTIFF datasets</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stencil Computations with Numba</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Introduction-to-Numba-Stencils">Introduction to Numba Stencils</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Dask-Array">Dask Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Generalized-Universal-Functions">Generalized Universal Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Start-Dask-Client-for-Dashboard">Start Dask Client for Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="#GPU-Version">GPU Version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="forecasting-with-prophet.html">Time Series Forecasting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Surveys</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../surveys/2019.html">2019 Dask User Survey Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../surveys/2020.html">2020 Dask User Survey Results</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dask Examples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Stencil Computations with Numba</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/applications/stencils-with-numba.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition-live-notebook admonition">
<p class="admonition-title">Live Notebook</p>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/main?urlpath=lab/tree/applications/stencils-with-numba.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/dask/dask-examples/main?urlpath=lab/tree/applications/stencils-with-numba.ipynb"><img alt="Binder" src="https://static.mybinder.org/badge_logo.svg" /></a> or view it <a class="reference external" href="https://github.com/dask/dask-examples/blob/main/applications/stencils-with-numba.ipynb">on Github</a>.</p>
</div>
<div class="section" id="Stencil-Computations-with-Numba">
<h1>Stencil Computations with Numba<a class="headerlink" href="#Stencil-Computations-with-Numba" title="Permalink to this headline">¶</a></h1>
<p><img alt="Numba Logo" class="no-scaled-link" src="https://numba.pydata.org/_static/numba-blue-horizontal-rgb.svg" width="40%" /></p>
<p>This notebook combines <a class="reference external" href="https://numba.pydata.org/">Numba</a>, a high performance Python compiler, with Dask Arrays.</p>
<p>In particular we show off two Numba features, and how they compose with Dask:</p>
<ol class="arabic simple">
<li><p>Numba’s <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/user/stencil.html">stencil decorator</a></p></li>
<li><p>NumPy’s <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/c-api.generalized-ufuncs.html">Generalized Universal Functions</a></p></li>
</ol>
<p><em>This was originally published as a blogpost</em><a class="reference external" href="https://blog.dask.org/2019/04/09/numba-stencil">here</a></p>
<div class="section" id="Introduction-to-Numba-Stencils">
<h2>Introduction to Numba Stencils<a class="headerlink" href="#Introduction-to-Numba-Stencils" title="Permalink to this headline">¶</a></h2>
<p>Many array computing functions operate only on a local region of the array. This is common in image processing, signals processing, simulation, the solution of differential equations, anomaly detection, time series analysis, and more. Typically we write code that looks like the following:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                         <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                         <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span>  <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span>  <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span>  <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">9</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
<p>Or something similar. The <code class="docutils literal notranslate"><span class="pre">numba.stencil</span></code> decorator makes this a bit easier to write down. You just write down what happens on every element, and Numba handles the rest.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numba</span>

<span class="nd">@numba</span><span class="o">.</span><span class="n">stencil</span>
<span class="k">def</span> <span class="nf">_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
            <span class="n">x</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
            <span class="n">x</span><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">9</span>
</pre></div>
</div>
</div>
<p>When we run this function on a NumPy array, we find that it is slow, operating at Python speeds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="o">%</span><span class="k">timeit</span> _smooth(x)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
299 ms ± 2.91 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div></div>
</div>
<p>But if we JIT compile this function with Numba, then it runs more quickly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nd">@numba</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="o">%</span><span class="k">timeit</span> smooth(x)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
170 µs ± 22.9 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div></div>
</div>
<p>For those counting, that’s over 1000x faster!</p>
<p><em>Note: this function already exists as ``scipy.ndimage.uniform_filter``, which operates at the same speed.</em></p>
</div>
<div class="section" id="Dask-Array">
<h2>Dask Array<a class="headerlink" href="#Dask-Array" title="Permalink to this headline">¶</a></h2>
<p>In these applications people often have many such arrays and they want to apply this function over all of them. In principle they could do this with a for loop.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">skimage.io</span>

<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/path/to/*.png&#39;</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.out.png&#39;</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>If they wanted to then do this in parallel they would maybe use the multiprocessing or concurrent.futures modules. If they wanted to do this across a cluster then they could rewrite their code with PySpark or some other system.</p>
<p>Or, they could use Dask array, which will handle both the pipelining and the parallelism (single machine or on a cluster) all while still looking mostly like a NumPy array.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask_image</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">dask_image</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;/path/to/*.png&#39;</span><span class="p">)</span>  <span class="c1"># a large lazy array of all of our images</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And then because each of the chunks of a Dask array are just NumPy arrays, we can use the <a class="reference external" href="https://docs.dask.org/en/latest/array-api.html#dask.array.core.map_blocks">map_blocks</a> function to apply this function across all of our images, and then save them out.</p>
<p>This is fine, but lets go a bit further, and discuss generalized universal functions from NumPy.</p>
<p>Because we don’t have a stack of images nearby, we’re going to make a random array with similar structure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;64 MB&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int8&#39;</span><span class="p">)</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 10.00 GB </td> <td> 50.00 MB </td></tr>
    <tr><th> Shape </th><td> (10000, 1000, 1000) </td> <td> (50, 1000, 1000) </td></tr>
    <tr><th> Count </th><td> 200 Tasks </td><td> 200 Chunks </td></tr>
    <tr><th> Type </th><td> int8 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="169" height="159" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="38" x2="80" y2="109" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="38" style="stroke-width:2" />
  <line x1="10" y1="0" x2="10" y2="38" />
  <line x1="10" y1="0" x2="10" y2="39" />
  <line x1="11" y1="1" x2="11" y2="39" />
  <line x1="11" y1="1" x2="11" y2="40" />
  <line x1="11" y1="1" x2="11" y2="40" />
  <line x1="12" y1="2" x2="12" y2="40" />
  <line x1="12" y1="2" x2="12" y2="41" />
  <line x1="12" y1="2" x2="12" y2="41" />
  <line x1="13" y1="3" x2="13" y2="41" />
  <line x1="13" y1="3" x2="13" y2="42" />
  <line x1="13" y1="3" x2="13" y2="42" />
  <line x1="14" y1="4" x2="14" y2="42" />
  <line x1="14" y1="4" x2="14" y2="43" />
  <line x1="14" y1="4" x2="14" y2="43" />
  <line x1="15" y1="5" x2="15" y2="43" />
  <line x1="15" y1="5" x2="15" y2="44" />
  <line x1="16" y1="6" x2="16" y2="44" />
  <line x1="16" y1="6" x2="16" y2="44" />
  <line x1="16" y1="6" x2="16" y2="45" />
  <line x1="17" y1="7" x2="17" y2="45" />
  <line x1="17" y1="7" x2="17" y2="46" />
  <line x1="17" y1="7" x2="17" y2="46" />
  <line x1="18" y1="8" x2="18" y2="46" />
  <line x1="18" y1="8" x2="18" y2="47" />
  <line x1="18" y1="8" x2="18" y2="47" />
  <line x1="19" y1="9" x2="19" y2="47" />
  <line x1="19" y1="9" x2="19" y2="48" />
  <line x1="19" y1="9" x2="19" y2="48" />
  <line x1="20" y1="10" x2="20" y2="48" />
  <line x1="20" y1="10" x2="20" y2="49" />
  <line x1="20" y1="10" x2="20" y2="49" />
  <line x1="21" y1="11" x2="21" y2="49" />
  <line x1="21" y1="11" x2="21" y2="50" />
  <line x1="22" y1="12" x2="22" y2="50" />
  <line x1="22" y1="12" x2="22" y2="50" />
  <line x1="22" y1="12" x2="22" y2="51" />
  <line x1="23" y1="13" x2="23" y2="51" />
  <line x1="23" y1="13" x2="23" y2="52" />
  <line x1="23" y1="13" x2="23" y2="52" />
  <line x1="24" y1="14" x2="24" y2="52" />
  <line x1="24" y1="14" x2="24" y2="53" />
  <line x1="24" y1="14" x2="24" y2="53" />
  <line x1="25" y1="15" x2="25" y2="53" />
  <line x1="25" y1="15" x2="25" y2="54" />
  <line x1="25" y1="15" x2="25" y2="54" />
  <line x1="26" y1="16" x2="26" y2="54" />
  <line x1="26" y1="16" x2="26" y2="55" />
  <line x1="26" y1="16" x2="26" y2="55" />
  <line x1="27" y1="17" x2="27" y2="55" />
  <line x1="27" y1="17" x2="27" y2="56" />
  <line x1="28" y1="18" x2="28" y2="56" />
  <line x1="28" y1="18" x2="28" y2="56" />
  <line x1="28" y1="18" x2="28" y2="57" />
  <line x1="29" y1="19" x2="29" y2="57" />
  <line x1="29" y1="19" x2="29" y2="58" />
  <line x1="29" y1="19" x2="29" y2="58" />
  <line x1="30" y1="20" x2="30" y2="58" />
  <line x1="30" y1="20" x2="30" y2="59" />
  <line x1="30" y1="20" x2="30" y2="59" />
  <line x1="31" y1="21" x2="31" y2="59" />
  <line x1="31" y1="21" x2="31" y2="60" />
  <line x1="31" y1="21" x2="31" y2="60" />
  <line x1="32" y1="22" x2="32" y2="60" />
  <line x1="32" y1="22" x2="32" y2="61" />
  <line x1="32" y1="22" x2="32" y2="61" />
  <line x1="33" y1="23" x2="33" y2="61" />
  <line x1="33" y1="23" x2="33" y2="62" />
  <line x1="34" y1="24" x2="34" y2="62" />
  <line x1="34" y1="24" x2="34" y2="62" />
  <line x1="34" y1="24" x2="34" y2="63" />
  <line x1="35" y1="25" x2="35" y2="63" />
  <line x1="35" y1="25" x2="35" y2="64" />
  <line x1="35" y1="25" x2="35" y2="64" />
  <line x1="36" y1="26" x2="36" y2="64" />
  <line x1="36" y1="26" x2="36" y2="65" />
  <line x1="36" y1="26" x2="36" y2="65" />
  <line x1="37" y1="27" x2="37" y2="65" />
  <line x1="37" y1="27" x2="37" y2="66" />
  <line x1="37" y1="27" x2="37" y2="66" />
  <line x1="38" y1="28" x2="38" y2="66" />
  <line x1="38" y1="28" x2="38" y2="67" />
  <line x1="38" y1="28" x2="38" y2="67" />
  <line x1="39" y1="29" x2="39" y2="67" />
  <line x1="39" y1="29" x2="39" y2="68" />
  <line x1="40" y1="30" x2="40" y2="68" />
  <line x1="40" y1="30" x2="40" y2="68" />
  <line x1="40" y1="30" x2="40" y2="69" />
  <line x1="41" y1="31" x2="41" y2="69" />
  <line x1="41" y1="31" x2="41" y2="70" />
  <line x1="41" y1="31" x2="41" y2="70" />
  <line x1="42" y1="32" x2="42" y2="70" />
  <line x1="42" y1="32" x2="42" y2="71" />
  <line x1="42" y1="32" x2="42" y2="71" />
  <line x1="43" y1="33" x2="43" y2="71" />
  <line x1="43" y1="33" x2="43" y2="72" />
  <line x1="43" y1="33" x2="43" y2="72" />
  <line x1="44" y1="34" x2="44" y2="72" />
  <line x1="44" y1="34" x2="44" y2="73" />
  <line x1="44" y1="34" x2="44" y2="73" />
  <line x1="45" y1="35" x2="45" y2="73" />
  <line x1="45" y1="35" x2="45" y2="74" />
  <line x1="46" y1="36" x2="46" y2="74" />
  <line x1="46" y1="36" x2="46" y2="74" />
  <line x1="46" y1="36" x2="46" y2="75" />
  <line x1="47" y1="37" x2="47" y2="75" />
  <line x1="47" y1="37" x2="47" y2="76" />
  <line x1="47" y1="37" x2="47" y2="76" />
  <line x1="48" y1="38" x2="48" y2="76" />
  <line x1="48" y1="38" x2="48" y2="77" />
  <line x1="48" y1="38" x2="48" y2="77" />
  <line x1="49" y1="39" x2="49" y2="77" />
  <line x1="49" y1="39" x2="49" y2="78" />
  <line x1="49" y1="39" x2="49" y2="78" />
  <line x1="50" y1="40" x2="50" y2="78" />
  <line x1="50" y1="40" x2="50" y2="79" />
  <line x1="50" y1="40" x2="50" y2="79" />
  <line x1="51" y1="41" x2="51" y2="79" />
  <line x1="51" y1="41" x2="51" y2="80" />
  <line x1="52" y1="42" x2="52" y2="80" />
  <line x1="52" y1="42" x2="52" y2="80" />
  <line x1="52" y1="42" x2="52" y2="81" />
  <line x1="53" y1="43" x2="53" y2="81" />
  <line x1="53" y1="43" x2="53" y2="82" />
  <line x1="53" y1="43" x2="53" y2="82" />
  <line x1="54" y1="44" x2="54" y2="82" />
  <line x1="54" y1="44" x2="54" y2="83" />
  <line x1="54" y1="44" x2="54" y2="83" />
  <line x1="55" y1="45" x2="55" y2="83" />
  <line x1="55" y1="45" x2="55" y2="84" />
  <line x1="55" y1="45" x2="55" y2="84" />
  <line x1="56" y1="46" x2="56" y2="84" />
  <line x1="56" y1="46" x2="56" y2="85" />
  <line x1="56" y1="46" x2="56" y2="85" />
  <line x1="57" y1="47" x2="57" y2="85" />
  <line x1="57" y1="47" x2="57" y2="86" />
  <line x1="58" y1="48" x2="58" y2="86" />
  <line x1="58" y1="48" x2="58" y2="86" />
  <line x1="58" y1="48" x2="58" y2="87" />
  <line x1="59" y1="49" x2="59" y2="87" />
  <line x1="59" y1="49" x2="59" y2="88" />
  <line x1="59" y1="49" x2="59" y2="88" />
  <line x1="60" y1="50" x2="60" y2="88" />
  <line x1="60" y1="50" x2="60" y2="89" />
  <line x1="60" y1="50" x2="60" y2="89" />
  <line x1="61" y1="51" x2="61" y2="89" />
  <line x1="61" y1="51" x2="61" y2="90" />
  <line x1="61" y1="51" x2="61" y2="90" />
  <line x1="62" y1="52" x2="62" y2="90" />
  <line x1="62" y1="52" x2="62" y2="91" />
  <line x1="62" y1="52" x2="62" y2="91" />
  <line x1="63" y1="53" x2="63" y2="91" />
  <line x1="63" y1="53" x2="63" y2="92" />
  <line x1="64" y1="54" x2="64" y2="92" />
  <line x1="64" y1="54" x2="64" y2="92" />
  <line x1="64" y1="54" x2="64" y2="93" />
  <line x1="65" y1="55" x2="65" y2="93" />
  <line x1="65" y1="55" x2="65" y2="94" />
  <line x1="65" y1="55" x2="65" y2="94" />
  <line x1="66" y1="56" x2="66" y2="94" />
  <line x1="66" y1="56" x2="66" y2="95" />
  <line x1="66" y1="56" x2="66" y2="95" />
  <line x1="67" y1="57" x2="67" y2="95" />
  <line x1="67" y1="57" x2="67" y2="96" />
  <line x1="67" y1="57" x2="67" y2="96" />
  <line x1="68" y1="58" x2="68" y2="96" />
  <line x1="68" y1="58" x2="68" y2="97" />
  <line x1="68" y1="58" x2="68" y2="97" />
  <line x1="69" y1="59" x2="69" y2="97" />
  <line x1="69" y1="59" x2="69" y2="98" />
  <line x1="70" y1="60" x2="70" y2="98" />
  <line x1="70" y1="60" x2="70" y2="98" />
  <line x1="70" y1="60" x2="70" y2="99" />
  <line x1="71" y1="61" x2="71" y2="99" />
  <line x1="71" y1="61" x2="71" y2="100" />
  <line x1="71" y1="61" x2="71" y2="100" />
  <line x1="72" y1="62" x2="72" y2="100" />
  <line x1="72" y1="62" x2="72" y2="101" />
  <line x1="72" y1="62" x2="72" y2="101" />
  <line x1="73" y1="63" x2="73" y2="101" />
  <line x1="73" y1="63" x2="73" y2="102" />
  <line x1="73" y1="63" x2="73" y2="102" />
  <line x1="74" y1="64" x2="74" y2="102" />
  <line x1="74" y1="64" x2="74" y2="103" />
  <line x1="74" y1="64" x2="74" y2="103" />
  <line x1="75" y1="65" x2="75" y2="103" />
  <line x1="75" y1="65" x2="75" y2="104" />
  <line x1="76" y1="66" x2="76" y2="104" />
  <line x1="76" y1="66" x2="76" y2="104" />
  <line x1="76" y1="66" x2="76" y2="105" />
  <line x1="77" y1="67" x2="77" y2="105" />
  <line x1="77" y1="67" x2="77" y2="106" />
  <line x1="77" y1="67" x2="77" y2="106" />
  <line x1="78" y1="68" x2="78" y2="106" />
  <line x1="78" y1="68" x2="78" y2="107" />
  <line x1="78" y1="68" x2="78" y2="107" />
  <line x1="79" y1="69" x2="79" y2="107" />
  <line x1="79" y1="69" x2="79" y2="108" />
  <line x1="79" y1="69" x2="79" y2="108" />
  <line x1="80" y1="70" x2="80" y2="108" />
  <line x1="80" y1="70" x2="80" y2="109" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 80.588235,70.588235 80.588235,109.185098 10.000000,38.596863" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="48" y2="0" style="stroke-width:2" />
  <line x1="10" y1="0" x2="48" y2="0" />
  <line x1="10" y1="0" x2="49" y2="0" />
  <line x1="11" y1="1" x2="49" y2="1" />
  <line x1="11" y1="1" x2="50" y2="1" />
  <line x1="11" y1="1" x2="50" y2="1" />
  <line x1="12" y1="2" x2="50" y2="2" />
  <line x1="12" y1="2" x2="51" y2="2" />
  <line x1="12" y1="2" x2="51" y2="2" />
  <line x1="13" y1="3" x2="51" y2="3" />
  <line x1="13" y1="3" x2="52" y2="3" />
  <line x1="13" y1="3" x2="52" y2="3" />
  <line x1="14" y1="4" x2="52" y2="4" />
  <line x1="14" y1="4" x2="53" y2="4" />
  <line x1="14" y1="4" x2="53" y2="4" />
  <line x1="15" y1="5" x2="53" y2="5" />
  <line x1="15" y1="5" x2="54" y2="5" />
  <line x1="16" y1="6" x2="54" y2="6" />
  <line x1="16" y1="6" x2="54" y2="6" />
  <line x1="16" y1="6" x2="55" y2="6" />
  <line x1="17" y1="7" x2="55" y2="7" />
  <line x1="17" y1="7" x2="56" y2="7" />
  <line x1="17" y1="7" x2="56" y2="7" />
  <line x1="18" y1="8" x2="56" y2="8" />
  <line x1="18" y1="8" x2="57" y2="8" />
  <line x1="18" y1="8" x2="57" y2="8" />
  <line x1="19" y1="9" x2="57" y2="9" />
  <line x1="19" y1="9" x2="58" y2="9" />
  <line x1="19" y1="9" x2="58" y2="9" />
  <line x1="20" y1="10" x2="58" y2="10" />
  <line x1="20" y1="10" x2="59" y2="10" />
  <line x1="20" y1="10" x2="59" y2="10" />
  <line x1="21" y1="11" x2="59" y2="11" />
  <line x1="21" y1="11" x2="60" y2="11" />
  <line x1="22" y1="12" x2="60" y2="12" />
  <line x1="22" y1="12" x2="60" y2="12" />
  <line x1="22" y1="12" x2="61" y2="12" />
  <line x1="23" y1="13" x2="61" y2="13" />
  <line x1="23" y1="13" x2="62" y2="13" />
  <line x1="23" y1="13" x2="62" y2="13" />
  <line x1="24" y1="14" x2="62" y2="14" />
  <line x1="24" y1="14" x2="63" y2="14" />
  <line x1="24" y1="14" x2="63" y2="14" />
  <line x1="25" y1="15" x2="63" y2="15" />
  <line x1="25" y1="15" x2="64" y2="15" />
  <line x1="25" y1="15" x2="64" y2="15" />
  <line x1="26" y1="16" x2="64" y2="16" />
  <line x1="26" y1="16" x2="65" y2="16" />
  <line x1="26" y1="16" x2="65" y2="16" />
  <line x1="27" y1="17" x2="65" y2="17" />
  <line x1="27" y1="17" x2="66" y2="17" />
  <line x1="28" y1="18" x2="66" y2="18" />
  <line x1="28" y1="18" x2="66" y2="18" />
  <line x1="28" y1="18" x2="67" y2="18" />
  <line x1="29" y1="19" x2="67" y2="19" />
  <line x1="29" y1="19" x2="68" y2="19" />
  <line x1="29" y1="19" x2="68" y2="19" />
  <line x1="30" y1="20" x2="68" y2="20" />
  <line x1="30" y1="20" x2="69" y2="20" />
  <line x1="30" y1="20" x2="69" y2="20" />
  <line x1="31" y1="21" x2="69" y2="21" />
  <line x1="31" y1="21" x2="70" y2="21" />
  <line x1="31" y1="21" x2="70" y2="21" />
  <line x1="32" y1="22" x2="70" y2="22" />
  <line x1="32" y1="22" x2="71" y2="22" />
  <line x1="32" y1="22" x2="71" y2="22" />
  <line x1="33" y1="23" x2="71" y2="23" />
  <line x1="33" y1="23" x2="72" y2="23" />
  <line x1="34" y1="24" x2="72" y2="24" />
  <line x1="34" y1="24" x2="72" y2="24" />
  <line x1="34" y1="24" x2="73" y2="24" />
  <line x1="35" y1="25" x2="73" y2="25" />
  <line x1="35" y1="25" x2="74" y2="25" />
  <line x1="35" y1="25" x2="74" y2="25" />
  <line x1="36" y1="26" x2="74" y2="26" />
  <line x1="36" y1="26" x2="75" y2="26" />
  <line x1="36" y1="26" x2="75" y2="26" />
  <line x1="37" y1="27" x2="75" y2="27" />
  <line x1="37" y1="27" x2="76" y2="27" />
  <line x1="37" y1="27" x2="76" y2="27" />
  <line x1="38" y1="28" x2="76" y2="28" />
  <line x1="38" y1="28" x2="77" y2="28" />
  <line x1="38" y1="28" x2="77" y2="28" />
  <line x1="39" y1="29" x2="77" y2="29" />
  <line x1="39" y1="29" x2="78" y2="29" />
  <line x1="40" y1="30" x2="78" y2="30" />
  <line x1="40" y1="30" x2="78" y2="30" />
  <line x1="40" y1="30" x2="79" y2="30" />
  <line x1="41" y1="31" x2="79" y2="31" />
  <line x1="41" y1="31" x2="80" y2="31" />
  <line x1="41" y1="31" x2="80" y2="31" />
  <line x1="42" y1="32" x2="80" y2="32" />
  <line x1="42" y1="32" x2="81" y2="32" />
  <line x1="42" y1="32" x2="81" y2="32" />
  <line x1="43" y1="33" x2="81" y2="33" />
  <line x1="43" y1="33" x2="82" y2="33" />
  <line x1="43" y1="33" x2="82" y2="33" />
  <line x1="44" y1="34" x2="82" y2="34" />
  <line x1="44" y1="34" x2="83" y2="34" />
  <line x1="44" y1="34" x2="83" y2="34" />
  <line x1="45" y1="35" x2="83" y2="35" />
  <line x1="45" y1="35" x2="84" y2="35" />
  <line x1="46" y1="36" x2="84" y2="36" />
  <line x1="46" y1="36" x2="84" y2="36" />
  <line x1="46" y1="36" x2="85" y2="36" />
  <line x1="47" y1="37" x2="85" y2="37" />
  <line x1="47" y1="37" x2="86" y2="37" />
  <line x1="47" y1="37" x2="86" y2="37" />
  <line x1="48" y1="38" x2="86" y2="38" />
  <line x1="48" y1="38" x2="87" y2="38" />
  <line x1="48" y1="38" x2="87" y2="38" />
  <line x1="49" y1="39" x2="87" y2="39" />
  <line x1="49" y1="39" x2="88" y2="39" />
  <line x1="49" y1="39" x2="88" y2="39" />
  <line x1="50" y1="40" x2="88" y2="40" />
  <line x1="50" y1="40" x2="89" y2="40" />
  <line x1="50" y1="40" x2="89" y2="40" />
  <line x1="51" y1="41" x2="89" y2="41" />
  <line x1="51" y1="41" x2="90" y2="41" />
  <line x1="52" y1="42" x2="90" y2="42" />
  <line x1="52" y1="42" x2="90" y2="42" />
  <line x1="52" y1="42" x2="91" y2="42" />
  <line x1="53" y1="43" x2="91" y2="43" />
  <line x1="53" y1="43" x2="92" y2="43" />
  <line x1="53" y1="43" x2="92" y2="43" />
  <line x1="54" y1="44" x2="92" y2="44" />
  <line x1="54" y1="44" x2="93" y2="44" />
  <line x1="54" y1="44" x2="93" y2="44" />
  <line x1="55" y1="45" x2="93" y2="45" />
  <line x1="55" y1="45" x2="94" y2="45" />
  <line x1="55" y1="45" x2="94" y2="45" />
  <line x1="56" y1="46" x2="94" y2="46" />
  <line x1="56" y1="46" x2="95" y2="46" />
  <line x1="56" y1="46" x2="95" y2="46" />
  <line x1="57" y1="47" x2="95" y2="47" />
  <line x1="57" y1="47" x2="96" y2="47" />
  <line x1="58" y1="48" x2="96" y2="48" />
  <line x1="58" y1="48" x2="96" y2="48" />
  <line x1="58" y1="48" x2="97" y2="48" />
  <line x1="59" y1="49" x2="97" y2="49" />
  <line x1="59" y1="49" x2="98" y2="49" />
  <line x1="59" y1="49" x2="98" y2="49" />
  <line x1="60" y1="50" x2="98" y2="50" />
  <line x1="60" y1="50" x2="99" y2="50" />
  <line x1="60" y1="50" x2="99" y2="50" />
  <line x1="61" y1="51" x2="99" y2="51" />
  <line x1="61" y1="51" x2="100" y2="51" />
  <line x1="61" y1="51" x2="100" y2="51" />
  <line x1="62" y1="52" x2="100" y2="52" />
  <line x1="62" y1="52" x2="101" y2="52" />
  <line x1="62" y1="52" x2="101" y2="52" />
  <line x1="63" y1="53" x2="101" y2="53" />
  <line x1="63" y1="53" x2="102" y2="53" />
  <line x1="64" y1="54" x2="102" y2="54" />
  <line x1="64" y1="54" x2="102" y2="54" />
  <line x1="64" y1="54" x2="103" y2="54" />
  <line x1="65" y1="55" x2="103" y2="55" />
  <line x1="65" y1="55" x2="104" y2="55" />
  <line x1="65" y1="55" x2="104" y2="55" />
  <line x1="66" y1="56" x2="104" y2="56" />
  <line x1="66" y1="56" x2="105" y2="56" />
  <line x1="66" y1="56" x2="105" y2="56" />
  <line x1="67" y1="57" x2="105" y2="57" />
  <line x1="67" y1="57" x2="106" y2="57" />
  <line x1="67" y1="57" x2="106" y2="57" />
  <line x1="68" y1="58" x2="106" y2="58" />
  <line x1="68" y1="58" x2="107" y2="58" />
  <line x1="68" y1="58" x2="107" y2="58" />
  <line x1="69" y1="59" x2="107" y2="59" />
  <line x1="69" y1="59" x2="108" y2="59" />
  <line x1="70" y1="60" x2="108" y2="60" />
  <line x1="70" y1="60" x2="108" y2="60" />
  <line x1="70" y1="60" x2="109" y2="60" />
  <line x1="71" y1="61" x2="109" y2="61" />
  <line x1="71" y1="61" x2="110" y2="61" />
  <line x1="71" y1="61" x2="110" y2="61" />
  <line x1="72" y1="62" x2="110" y2="62" />
  <line x1="72" y1="62" x2="111" y2="62" />
  <line x1="72" y1="62" x2="111" y2="62" />
  <line x1="73" y1="63" x2="111" y2="63" />
  <line x1="73" y1="63" x2="112" y2="63" />
  <line x1="73" y1="63" x2="112" y2="63" />
  <line x1="74" y1="64" x2="112" y2="64" />
  <line x1="74" y1="64" x2="113" y2="64" />
  <line x1="74" y1="64" x2="113" y2="64" />
  <line x1="75" y1="65" x2="113" y2="65" />
  <line x1="75" y1="65" x2="114" y2="65" />
  <line x1="76" y1="66" x2="114" y2="66" />
  <line x1="76" y1="66" x2="114" y2="66" />
  <line x1="76" y1="66" x2="115" y2="66" />
  <line x1="77" y1="67" x2="115" y2="67" />
  <line x1="77" y1="67" x2="116" y2="67" />
  <line x1="77" y1="67" x2="116" y2="67" />
  <line x1="78" y1="68" x2="116" y2="68" />
  <line x1="78" y1="68" x2="117" y2="68" />
  <line x1="78" y1="68" x2="117" y2="68" />
  <line x1="79" y1="69" x2="117" y2="69" />
  <line x1="79" y1="69" x2="118" y2="69" />
  <line x1="79" y1="69" x2="118" y2="69" />
  <line x1="80" y1="70" x2="118" y2="70" />
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="48" y1="0" x2="119" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 48.596863,0.000000 119.185098,70.588235 80.588235,70.588235" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />
  <line x1="80" y1="109" x2="119" y2="109" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="109" style="stroke-width:2" />
  <line x1="119" y1="70" x2="119" y2="109" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.588235,70.588235 119.185098,70.588235 119.185098,109.185098 80.588235,109.185098" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="99.886667" y="129.185098" font-size="1.0rem" font-weight="100" text-anchor="middle" >1000</text>
  <text x="139.185098" y="89.886667" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,139.185098,89.886667)">1000</text>
  <text x="35.294118" y="93.890981" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,93.890981)">10000</text>
</svg>
</td>
</tr>
</table></div>
</div>
</div>
<div class="section" id="Generalized-Universal-Functions">
<h2>Generalized Universal Functions<a class="headerlink" href="#Generalized-Universal-Functions" title="Permalink to this headline">¶</a></h2>
<p><strong>Numba Docs:</strong> <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/user/vectorize.html">https://numba.pydata.org/numba-doc/dev/user/vectorize.html</a></p>
<p><strong>NumPy Docs:</strong> <a class="reference external" href="https://docs.scipy.org/doc/numpy-1.16.0/reference/c-api">https://docs.scipy.org/doc/numpy-1.16.0/reference/c-api</a>. generalized-ufuncs.html</p>
<p>A generalized universal function (gufunc) is a normal function that has been annotated with typing and dimension information. For example we can redefine our <code class="docutils literal notranslate"><span class="pre">smooth</span></code> function as a gufunc as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nd">@numba</span><span class="o">.</span><span class="n">guvectorize</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">numba</span><span class="o">.</span><span class="n">int8</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">numba</span><span class="o">.</span><span class="n">int8</span><span class="p">[:,</span> <span class="p">:])],</span>
    <span class="s1">&#39;(n, m) -&gt; (n, m)&#39;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="n">out</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This function knows that it consumes a 2d array of int8’s and produces a 2d array of int8’s of the same dimensions.</p>
<p>This sort of annotation is a small change, but it gives other systems like Dask enough information to use it intelligently. Rather than call functions like <code class="docutils literal notranslate"><span class="pre">map_blocks</span></code>, we can just use the function directly, as if our Dask Array was just a very large NumPy array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Before gufuncs</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int8&#39;</span><span class="p">)</span>

<span class="c1"># After gufuncs</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 10.00 GB </td> <td> 50.00 MB </td></tr>
    <tr><th> Shape </th><td> (10000, 1000, 1000) </td> <td> (50, 1000, 1000) </td></tr>
    <tr><th> Count </th><td> 800 Tasks </td><td> 200 Chunks </td></tr>
    <tr><th> Type </th><td> int8 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="169" height="159" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="38" x2="80" y2="109" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="38" style="stroke-width:2" />
  <line x1="10" y1="0" x2="10" y2="38" />
  <line x1="10" y1="0" x2="10" y2="39" />
  <line x1="11" y1="1" x2="11" y2="39" />
  <line x1="11" y1="1" x2="11" y2="40" />
  <line x1="11" y1="1" x2="11" y2="40" />
  <line x1="12" y1="2" x2="12" y2="40" />
  <line x1="12" y1="2" x2="12" y2="41" />
  <line x1="12" y1="2" x2="12" y2="41" />
  <line x1="13" y1="3" x2="13" y2="41" />
  <line x1="13" y1="3" x2="13" y2="42" />
  <line x1="13" y1="3" x2="13" y2="42" />
  <line x1="14" y1="4" x2="14" y2="42" />
  <line x1="14" y1="4" x2="14" y2="43" />
  <line x1="14" y1="4" x2="14" y2="43" />
  <line x1="15" y1="5" x2="15" y2="43" />
  <line x1="15" y1="5" x2="15" y2="44" />
  <line x1="16" y1="6" x2="16" y2="44" />
  <line x1="16" y1="6" x2="16" y2="44" />
  <line x1="16" y1="6" x2="16" y2="45" />
  <line x1="17" y1="7" x2="17" y2="45" />
  <line x1="17" y1="7" x2="17" y2="46" />
  <line x1="17" y1="7" x2="17" y2="46" />
  <line x1="18" y1="8" x2="18" y2="46" />
  <line x1="18" y1="8" x2="18" y2="47" />
  <line x1="18" y1="8" x2="18" y2="47" />
  <line x1="19" y1="9" x2="19" y2="47" />
  <line x1="19" y1="9" x2="19" y2="48" />
  <line x1="19" y1="9" x2="19" y2="48" />
  <line x1="20" y1="10" x2="20" y2="48" />
  <line x1="20" y1="10" x2="20" y2="49" />
  <line x1="20" y1="10" x2="20" y2="49" />
  <line x1="21" y1="11" x2="21" y2="49" />
  <line x1="21" y1="11" x2="21" y2="50" />
  <line x1="22" y1="12" x2="22" y2="50" />
  <line x1="22" y1="12" x2="22" y2="50" />
  <line x1="22" y1="12" x2="22" y2="51" />
  <line x1="23" y1="13" x2="23" y2="51" />
  <line x1="23" y1="13" x2="23" y2="52" />
  <line x1="23" y1="13" x2="23" y2="52" />
  <line x1="24" y1="14" x2="24" y2="52" />
  <line x1="24" y1="14" x2="24" y2="53" />
  <line x1="24" y1="14" x2="24" y2="53" />
  <line x1="25" y1="15" x2="25" y2="53" />
  <line x1="25" y1="15" x2="25" y2="54" />
  <line x1="25" y1="15" x2="25" y2="54" />
  <line x1="26" y1="16" x2="26" y2="54" />
  <line x1="26" y1="16" x2="26" y2="55" />
  <line x1="26" y1="16" x2="26" y2="55" />
  <line x1="27" y1="17" x2="27" y2="55" />
  <line x1="27" y1="17" x2="27" y2="56" />
  <line x1="28" y1="18" x2="28" y2="56" />
  <line x1="28" y1="18" x2="28" y2="56" />
  <line x1="28" y1="18" x2="28" y2="57" />
  <line x1="29" y1="19" x2="29" y2="57" />
  <line x1="29" y1="19" x2="29" y2="58" />
  <line x1="29" y1="19" x2="29" y2="58" />
  <line x1="30" y1="20" x2="30" y2="58" />
  <line x1="30" y1="20" x2="30" y2="59" />
  <line x1="30" y1="20" x2="30" y2="59" />
  <line x1="31" y1="21" x2="31" y2="59" />
  <line x1="31" y1="21" x2="31" y2="60" />
  <line x1="31" y1="21" x2="31" y2="60" />
  <line x1="32" y1="22" x2="32" y2="60" />
  <line x1="32" y1="22" x2="32" y2="61" />
  <line x1="32" y1="22" x2="32" y2="61" />
  <line x1="33" y1="23" x2="33" y2="61" />
  <line x1="33" y1="23" x2="33" y2="62" />
  <line x1="34" y1="24" x2="34" y2="62" />
  <line x1="34" y1="24" x2="34" y2="62" />
  <line x1="34" y1="24" x2="34" y2="63" />
  <line x1="35" y1="25" x2="35" y2="63" />
  <line x1="35" y1="25" x2="35" y2="64" />
  <line x1="35" y1="25" x2="35" y2="64" />
  <line x1="36" y1="26" x2="36" y2="64" />
  <line x1="36" y1="26" x2="36" y2="65" />
  <line x1="36" y1="26" x2="36" y2="65" />
  <line x1="37" y1="27" x2="37" y2="65" />
  <line x1="37" y1="27" x2="37" y2="66" />
  <line x1="37" y1="27" x2="37" y2="66" />
  <line x1="38" y1="28" x2="38" y2="66" />
  <line x1="38" y1="28" x2="38" y2="67" />
  <line x1="38" y1="28" x2="38" y2="67" />
  <line x1="39" y1="29" x2="39" y2="67" />
  <line x1="39" y1="29" x2="39" y2="68" />
  <line x1="40" y1="30" x2="40" y2="68" />
  <line x1="40" y1="30" x2="40" y2="68" />
  <line x1="40" y1="30" x2="40" y2="69" />
  <line x1="41" y1="31" x2="41" y2="69" />
  <line x1="41" y1="31" x2="41" y2="70" />
  <line x1="41" y1="31" x2="41" y2="70" />
  <line x1="42" y1="32" x2="42" y2="70" />
  <line x1="42" y1="32" x2="42" y2="71" />
  <line x1="42" y1="32" x2="42" y2="71" />
  <line x1="43" y1="33" x2="43" y2="71" />
  <line x1="43" y1="33" x2="43" y2="72" />
  <line x1="43" y1="33" x2="43" y2="72" />
  <line x1="44" y1="34" x2="44" y2="72" />
  <line x1="44" y1="34" x2="44" y2="73" />
  <line x1="44" y1="34" x2="44" y2="73" />
  <line x1="45" y1="35" x2="45" y2="73" />
  <line x1="45" y1="35" x2="45" y2="74" />
  <line x1="46" y1="36" x2="46" y2="74" />
  <line x1="46" y1="36" x2="46" y2="74" />
  <line x1="46" y1="36" x2="46" y2="75" />
  <line x1="47" y1="37" x2="47" y2="75" />
  <line x1="47" y1="37" x2="47" y2="76" />
  <line x1="47" y1="37" x2="47" y2="76" />
  <line x1="48" y1="38" x2="48" y2="76" />
  <line x1="48" y1="38" x2="48" y2="77" />
  <line x1="48" y1="38" x2="48" y2="77" />
  <line x1="49" y1="39" x2="49" y2="77" />
  <line x1="49" y1="39" x2="49" y2="78" />
  <line x1="49" y1="39" x2="49" y2="78" />
  <line x1="50" y1="40" x2="50" y2="78" />
  <line x1="50" y1="40" x2="50" y2="79" />
  <line x1="50" y1="40" x2="50" y2="79" />
  <line x1="51" y1="41" x2="51" y2="79" />
  <line x1="51" y1="41" x2="51" y2="80" />
  <line x1="52" y1="42" x2="52" y2="80" />
  <line x1="52" y1="42" x2="52" y2="80" />
  <line x1="52" y1="42" x2="52" y2="81" />
  <line x1="53" y1="43" x2="53" y2="81" />
  <line x1="53" y1="43" x2="53" y2="82" />
  <line x1="53" y1="43" x2="53" y2="82" />
  <line x1="54" y1="44" x2="54" y2="82" />
  <line x1="54" y1="44" x2="54" y2="83" />
  <line x1="54" y1="44" x2="54" y2="83" />
  <line x1="55" y1="45" x2="55" y2="83" />
  <line x1="55" y1="45" x2="55" y2="84" />
  <line x1="55" y1="45" x2="55" y2="84" />
  <line x1="56" y1="46" x2="56" y2="84" />
  <line x1="56" y1="46" x2="56" y2="85" />
  <line x1="56" y1="46" x2="56" y2="85" />
  <line x1="57" y1="47" x2="57" y2="85" />
  <line x1="57" y1="47" x2="57" y2="86" />
  <line x1="58" y1="48" x2="58" y2="86" />
  <line x1="58" y1="48" x2="58" y2="86" />
  <line x1="58" y1="48" x2="58" y2="87" />
  <line x1="59" y1="49" x2="59" y2="87" />
  <line x1="59" y1="49" x2="59" y2="88" />
  <line x1="59" y1="49" x2="59" y2="88" />
  <line x1="60" y1="50" x2="60" y2="88" />
  <line x1="60" y1="50" x2="60" y2="89" />
  <line x1="60" y1="50" x2="60" y2="89" />
  <line x1="61" y1="51" x2="61" y2="89" />
  <line x1="61" y1="51" x2="61" y2="90" />
  <line x1="61" y1="51" x2="61" y2="90" />
  <line x1="62" y1="52" x2="62" y2="90" />
  <line x1="62" y1="52" x2="62" y2="91" />
  <line x1="62" y1="52" x2="62" y2="91" />
  <line x1="63" y1="53" x2="63" y2="91" />
  <line x1="63" y1="53" x2="63" y2="92" />
  <line x1="64" y1="54" x2="64" y2="92" />
  <line x1="64" y1="54" x2="64" y2="92" />
  <line x1="64" y1="54" x2="64" y2="93" />
  <line x1="65" y1="55" x2="65" y2="93" />
  <line x1="65" y1="55" x2="65" y2="94" />
  <line x1="65" y1="55" x2="65" y2="94" />
  <line x1="66" y1="56" x2="66" y2="94" />
  <line x1="66" y1="56" x2="66" y2="95" />
  <line x1="66" y1="56" x2="66" y2="95" />
  <line x1="67" y1="57" x2="67" y2="95" />
  <line x1="67" y1="57" x2="67" y2="96" />
  <line x1="67" y1="57" x2="67" y2="96" />
  <line x1="68" y1="58" x2="68" y2="96" />
  <line x1="68" y1="58" x2="68" y2="97" />
  <line x1="68" y1="58" x2="68" y2="97" />
  <line x1="69" y1="59" x2="69" y2="97" />
  <line x1="69" y1="59" x2="69" y2="98" />
  <line x1="70" y1="60" x2="70" y2="98" />
  <line x1="70" y1="60" x2="70" y2="98" />
  <line x1="70" y1="60" x2="70" y2="99" />
  <line x1="71" y1="61" x2="71" y2="99" />
  <line x1="71" y1="61" x2="71" y2="100" />
  <line x1="71" y1="61" x2="71" y2="100" />
  <line x1="72" y1="62" x2="72" y2="100" />
  <line x1="72" y1="62" x2="72" y2="101" />
  <line x1="72" y1="62" x2="72" y2="101" />
  <line x1="73" y1="63" x2="73" y2="101" />
  <line x1="73" y1="63" x2="73" y2="102" />
  <line x1="73" y1="63" x2="73" y2="102" />
  <line x1="74" y1="64" x2="74" y2="102" />
  <line x1="74" y1="64" x2="74" y2="103" />
  <line x1="74" y1="64" x2="74" y2="103" />
  <line x1="75" y1="65" x2="75" y2="103" />
  <line x1="75" y1="65" x2="75" y2="104" />
  <line x1="76" y1="66" x2="76" y2="104" />
  <line x1="76" y1="66" x2="76" y2="104" />
  <line x1="76" y1="66" x2="76" y2="105" />
  <line x1="77" y1="67" x2="77" y2="105" />
  <line x1="77" y1="67" x2="77" y2="106" />
  <line x1="77" y1="67" x2="77" y2="106" />
  <line x1="78" y1="68" x2="78" y2="106" />
  <line x1="78" y1="68" x2="78" y2="107" />
  <line x1="78" y1="68" x2="78" y2="107" />
  <line x1="79" y1="69" x2="79" y2="107" />
  <line x1="79" y1="69" x2="79" y2="108" />
  <line x1="79" y1="69" x2="79" y2="108" />
  <line x1="80" y1="70" x2="80" y2="108" />
  <line x1="80" y1="70" x2="80" y2="109" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 80.588235,70.588235 80.588235,109.185098 10.000000,38.596863" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="48" y2="0" style="stroke-width:2" />
  <line x1="10" y1="0" x2="48" y2="0" />
  <line x1="10" y1="0" x2="49" y2="0" />
  <line x1="11" y1="1" x2="49" y2="1" />
  <line x1="11" y1="1" x2="50" y2="1" />
  <line x1="11" y1="1" x2="50" y2="1" />
  <line x1="12" y1="2" x2="50" y2="2" />
  <line x1="12" y1="2" x2="51" y2="2" />
  <line x1="12" y1="2" x2="51" y2="2" />
  <line x1="13" y1="3" x2="51" y2="3" />
  <line x1="13" y1="3" x2="52" y2="3" />
  <line x1="13" y1="3" x2="52" y2="3" />
  <line x1="14" y1="4" x2="52" y2="4" />
  <line x1="14" y1="4" x2="53" y2="4" />
  <line x1="14" y1="4" x2="53" y2="4" />
  <line x1="15" y1="5" x2="53" y2="5" />
  <line x1="15" y1="5" x2="54" y2="5" />
  <line x1="16" y1="6" x2="54" y2="6" />
  <line x1="16" y1="6" x2="54" y2="6" />
  <line x1="16" y1="6" x2="55" y2="6" />
  <line x1="17" y1="7" x2="55" y2="7" />
  <line x1="17" y1="7" x2="56" y2="7" />
  <line x1="17" y1="7" x2="56" y2="7" />
  <line x1="18" y1="8" x2="56" y2="8" />
  <line x1="18" y1="8" x2="57" y2="8" />
  <line x1="18" y1="8" x2="57" y2="8" />
  <line x1="19" y1="9" x2="57" y2="9" />
  <line x1="19" y1="9" x2="58" y2="9" />
  <line x1="19" y1="9" x2="58" y2="9" />
  <line x1="20" y1="10" x2="58" y2="10" />
  <line x1="20" y1="10" x2="59" y2="10" />
  <line x1="20" y1="10" x2="59" y2="10" />
  <line x1="21" y1="11" x2="59" y2="11" />
  <line x1="21" y1="11" x2="60" y2="11" />
  <line x1="22" y1="12" x2="60" y2="12" />
  <line x1="22" y1="12" x2="60" y2="12" />
  <line x1="22" y1="12" x2="61" y2="12" />
  <line x1="23" y1="13" x2="61" y2="13" />
  <line x1="23" y1="13" x2="62" y2="13" />
  <line x1="23" y1="13" x2="62" y2="13" />
  <line x1="24" y1="14" x2="62" y2="14" />
  <line x1="24" y1="14" x2="63" y2="14" />
  <line x1="24" y1="14" x2="63" y2="14" />
  <line x1="25" y1="15" x2="63" y2="15" />
  <line x1="25" y1="15" x2="64" y2="15" />
  <line x1="25" y1="15" x2="64" y2="15" />
  <line x1="26" y1="16" x2="64" y2="16" />
  <line x1="26" y1="16" x2="65" y2="16" />
  <line x1="26" y1="16" x2="65" y2="16" />
  <line x1="27" y1="17" x2="65" y2="17" />
  <line x1="27" y1="17" x2="66" y2="17" />
  <line x1="28" y1="18" x2="66" y2="18" />
  <line x1="28" y1="18" x2="66" y2="18" />
  <line x1="28" y1="18" x2="67" y2="18" />
  <line x1="29" y1="19" x2="67" y2="19" />
  <line x1="29" y1="19" x2="68" y2="19" />
  <line x1="29" y1="19" x2="68" y2="19" />
  <line x1="30" y1="20" x2="68" y2="20" />
  <line x1="30" y1="20" x2="69" y2="20" />
  <line x1="30" y1="20" x2="69" y2="20" />
  <line x1="31" y1="21" x2="69" y2="21" />
  <line x1="31" y1="21" x2="70" y2="21" />
  <line x1="31" y1="21" x2="70" y2="21" />
  <line x1="32" y1="22" x2="70" y2="22" />
  <line x1="32" y1="22" x2="71" y2="22" />
  <line x1="32" y1="22" x2="71" y2="22" />
  <line x1="33" y1="23" x2="71" y2="23" />
  <line x1="33" y1="23" x2="72" y2="23" />
  <line x1="34" y1="24" x2="72" y2="24" />
  <line x1="34" y1="24" x2="72" y2="24" />
  <line x1="34" y1="24" x2="73" y2="24" />
  <line x1="35" y1="25" x2="73" y2="25" />
  <line x1="35" y1="25" x2="74" y2="25" />
  <line x1="35" y1="25" x2="74" y2="25" />
  <line x1="36" y1="26" x2="74" y2="26" />
  <line x1="36" y1="26" x2="75" y2="26" />
  <line x1="36" y1="26" x2="75" y2="26" />
  <line x1="37" y1="27" x2="75" y2="27" />
  <line x1="37" y1="27" x2="76" y2="27" />
  <line x1="37" y1="27" x2="76" y2="27" />
  <line x1="38" y1="28" x2="76" y2="28" />
  <line x1="38" y1="28" x2="77" y2="28" />
  <line x1="38" y1="28" x2="77" y2="28" />
  <line x1="39" y1="29" x2="77" y2="29" />
  <line x1="39" y1="29" x2="78" y2="29" />
  <line x1="40" y1="30" x2="78" y2="30" />
  <line x1="40" y1="30" x2="78" y2="30" />
  <line x1="40" y1="30" x2="79" y2="30" />
  <line x1="41" y1="31" x2="79" y2="31" />
  <line x1="41" y1="31" x2="80" y2="31" />
  <line x1="41" y1="31" x2="80" y2="31" />
  <line x1="42" y1="32" x2="80" y2="32" />
  <line x1="42" y1="32" x2="81" y2="32" />
  <line x1="42" y1="32" x2="81" y2="32" />
  <line x1="43" y1="33" x2="81" y2="33" />
  <line x1="43" y1="33" x2="82" y2="33" />
  <line x1="43" y1="33" x2="82" y2="33" />
  <line x1="44" y1="34" x2="82" y2="34" />
  <line x1="44" y1="34" x2="83" y2="34" />
  <line x1="44" y1="34" x2="83" y2="34" />
  <line x1="45" y1="35" x2="83" y2="35" />
  <line x1="45" y1="35" x2="84" y2="35" />
  <line x1="46" y1="36" x2="84" y2="36" />
  <line x1="46" y1="36" x2="84" y2="36" />
  <line x1="46" y1="36" x2="85" y2="36" />
  <line x1="47" y1="37" x2="85" y2="37" />
  <line x1="47" y1="37" x2="86" y2="37" />
  <line x1="47" y1="37" x2="86" y2="37" />
  <line x1="48" y1="38" x2="86" y2="38" />
  <line x1="48" y1="38" x2="87" y2="38" />
  <line x1="48" y1="38" x2="87" y2="38" />
  <line x1="49" y1="39" x2="87" y2="39" />
  <line x1="49" y1="39" x2="88" y2="39" />
  <line x1="49" y1="39" x2="88" y2="39" />
  <line x1="50" y1="40" x2="88" y2="40" />
  <line x1="50" y1="40" x2="89" y2="40" />
  <line x1="50" y1="40" x2="89" y2="40" />
  <line x1="51" y1="41" x2="89" y2="41" />
  <line x1="51" y1="41" x2="90" y2="41" />
  <line x1="52" y1="42" x2="90" y2="42" />
  <line x1="52" y1="42" x2="90" y2="42" />
  <line x1="52" y1="42" x2="91" y2="42" />
  <line x1="53" y1="43" x2="91" y2="43" />
  <line x1="53" y1="43" x2="92" y2="43" />
  <line x1="53" y1="43" x2="92" y2="43" />
  <line x1="54" y1="44" x2="92" y2="44" />
  <line x1="54" y1="44" x2="93" y2="44" />
  <line x1="54" y1="44" x2="93" y2="44" />
  <line x1="55" y1="45" x2="93" y2="45" />
  <line x1="55" y1="45" x2="94" y2="45" />
  <line x1="55" y1="45" x2="94" y2="45" />
  <line x1="56" y1="46" x2="94" y2="46" />
  <line x1="56" y1="46" x2="95" y2="46" />
  <line x1="56" y1="46" x2="95" y2="46" />
  <line x1="57" y1="47" x2="95" y2="47" />
  <line x1="57" y1="47" x2="96" y2="47" />
  <line x1="58" y1="48" x2="96" y2="48" />
  <line x1="58" y1="48" x2="96" y2="48" />
  <line x1="58" y1="48" x2="97" y2="48" />
  <line x1="59" y1="49" x2="97" y2="49" />
  <line x1="59" y1="49" x2="98" y2="49" />
  <line x1="59" y1="49" x2="98" y2="49" />
  <line x1="60" y1="50" x2="98" y2="50" />
  <line x1="60" y1="50" x2="99" y2="50" />
  <line x1="60" y1="50" x2="99" y2="50" />
  <line x1="61" y1="51" x2="99" y2="51" />
  <line x1="61" y1="51" x2="100" y2="51" />
  <line x1="61" y1="51" x2="100" y2="51" />
  <line x1="62" y1="52" x2="100" y2="52" />
  <line x1="62" y1="52" x2="101" y2="52" />
  <line x1="62" y1="52" x2="101" y2="52" />
  <line x1="63" y1="53" x2="101" y2="53" />
  <line x1="63" y1="53" x2="102" y2="53" />
  <line x1="64" y1="54" x2="102" y2="54" />
  <line x1="64" y1="54" x2="102" y2="54" />
  <line x1="64" y1="54" x2="103" y2="54" />
  <line x1="65" y1="55" x2="103" y2="55" />
  <line x1="65" y1="55" x2="104" y2="55" />
  <line x1="65" y1="55" x2="104" y2="55" />
  <line x1="66" y1="56" x2="104" y2="56" />
  <line x1="66" y1="56" x2="105" y2="56" />
  <line x1="66" y1="56" x2="105" y2="56" />
  <line x1="67" y1="57" x2="105" y2="57" />
  <line x1="67" y1="57" x2="106" y2="57" />
  <line x1="67" y1="57" x2="106" y2="57" />
  <line x1="68" y1="58" x2="106" y2="58" />
  <line x1="68" y1="58" x2="107" y2="58" />
  <line x1="68" y1="58" x2="107" y2="58" />
  <line x1="69" y1="59" x2="107" y2="59" />
  <line x1="69" y1="59" x2="108" y2="59" />
  <line x1="70" y1="60" x2="108" y2="60" />
  <line x1="70" y1="60" x2="108" y2="60" />
  <line x1="70" y1="60" x2="109" y2="60" />
  <line x1="71" y1="61" x2="109" y2="61" />
  <line x1="71" y1="61" x2="110" y2="61" />
  <line x1="71" y1="61" x2="110" y2="61" />
  <line x1="72" y1="62" x2="110" y2="62" />
  <line x1="72" y1="62" x2="111" y2="62" />
  <line x1="72" y1="62" x2="111" y2="62" />
  <line x1="73" y1="63" x2="111" y2="63" />
  <line x1="73" y1="63" x2="112" y2="63" />
  <line x1="73" y1="63" x2="112" y2="63" />
  <line x1="74" y1="64" x2="112" y2="64" />
  <line x1="74" y1="64" x2="113" y2="64" />
  <line x1="74" y1="64" x2="113" y2="64" />
  <line x1="75" y1="65" x2="113" y2="65" />
  <line x1="75" y1="65" x2="114" y2="65" />
  <line x1="76" y1="66" x2="114" y2="66" />
  <line x1="76" y1="66" x2="114" y2="66" />
  <line x1="76" y1="66" x2="115" y2="66" />
  <line x1="77" y1="67" x2="115" y2="67" />
  <line x1="77" y1="67" x2="116" y2="67" />
  <line x1="77" y1="67" x2="116" y2="67" />
  <line x1="78" y1="68" x2="116" y2="68" />
  <line x1="78" y1="68" x2="117" y2="68" />
  <line x1="78" y1="68" x2="117" y2="68" />
  <line x1="79" y1="69" x2="117" y2="69" />
  <line x1="79" y1="69" x2="118" y2="69" />
  <line x1="79" y1="69" x2="118" y2="69" />
  <line x1="80" y1="70" x2="118" y2="70" />
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="48" y1="0" x2="119" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.000000,0.000000 48.596863,0.000000 119.185098,70.588235 80.588235,70.588235" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="119" y2="70" style="stroke-width:2" />
  <line x1="80" y1="109" x2="119" y2="109" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="109" style="stroke-width:2" />
  <line x1="119" y1="70" x2="119" y2="109" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.588235,70.588235 119.185098,70.588235 119.185098,109.185098 80.588235,109.185098" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="99.886667" y="129.185098" font-size="1.0rem" font-weight="100" text-anchor="middle" >1000</text>
  <text x="139.185098" y="89.886667" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,139.185098,89.886667)">1000</text>
  <text x="35.294118" y="93.890981" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,93.890981)">10000</text>
</svg>
</td>
</tr>
</table></div>
</div>
<p>This is nice. If you write library code with gufunc semantics then that code just works with systems like Dask, without you having to build in explicit support for parallel computing. This makes the lives of users much easier.</p>
</div>
<div class="section" id="Start-Dask-Client-for-Dashboard">
<h2>Start Dask Client for Dashboard<a class="headerlink" href="#Start-Dask-Client-for-Dashboard" title="Permalink to this headline">¶</a></h2>
<p>Starting the Dask Client is optional. It will start the dashboard which is useful to gain insight on the computation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">progress</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">n_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">processes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">memory_limit</span><span class="o">=</span><span class="s1">&#39;4GB&#39;</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/share/miniconda3/envs/dask-examples/lib/python3.8/site-packages/distributed/node.py:151: UserWarning: Port 8787 is already in use.
Perhaps you already have a cluster running?
Hosting the HTTP server on port 33381 instead
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table style="border: 2px solid white;">
<tr>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Client</h3>
<ul style="text-align: left; list-style: none; margin: 0; padding: 0;">
  <li><b>Scheduler: </b>inproc://10.1.0.145/6423/1</li>
  <li><b>Dashboard: </b><a href='http://10.1.0.145:33381/status' target='_blank'>http://10.1.0.145:33381/status</a></li>
</ul>
</td>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Cluster</h3>
<ul style="text-align: left; list-style:none; margin: 0; padding: 0;">
  <li><b>Workers: </b>1</li>
  <li><b>Cores: </b>4</li>
  <li><b>Memory: </b>4.00 GB</li>
</ul>
</td>
</tr>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
122
</pre></div></div>
</div>
</div>
<div class="section" id="GPU-Version">
<h2>GPU Version<a class="headerlink" href="#GPU-Version" title="Permalink to this headline">¶</a></h2>
<p>Numba also supports a JIT compilation with CUDA on compatible GPU devices.</p>
<p>This gives about a 200x speedup over a CPU on a single V100 GPU using <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/cuda/index.html">numba.cuda.jit</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numba.cuda</span>

<span class="nd">@numba</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">smooth_gpu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">cuda</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">x</span><span class="p">[</span><span class="n">i</span>    <span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span>    <span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span>    <span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">9</span>

<span class="kn">import</span> <span class="nn">cupy</span><span class="o">,</span> <span class="nn">math</span>

<span class="n">x_gpu</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int8&#39;</span><span class="p">)</span>
<span class="n">out_gpu</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int8&#39;</span><span class="p">)</span>

<span class="c1"># I copied the four lines below from the Numba docs</span>
<span class="n">threadsperblock</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">blockspergrid_x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x_gpu</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">threadsperblock</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">blockspergrid_y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x_gpu</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">threadsperblock</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">blockspergrid</span> <span class="o">=</span> <span class="p">(</span><span class="n">blockspergrid_x</span><span class="p">,</span> <span class="n">blockspergrid_y</span><span class="p">)</span>

<span class="n">smooth_gpu</span><span class="p">[</span><span class="n">blockspergrid</span><span class="p">,</span> <span class="n">threadsperblock</span><span class="p">](</span><span class="n">x_gpu</span><span class="p">,</span> <span class="n">out_gpu</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Full notebook</em><a class="reference external" href="https://gist.github.com/mrocklin/9272bf84a8faffdbbe2cd44b4bc4ce3c">here</a></p>
</div>
</div>
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-18218874-5', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="forecasting-with-prophet.html" class="btn btn-neutral float-right" title="Time Series Forecasting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="satellite-imagery-geotiff.html" class="btn btn-neutral float-left" title="Reading and manipulating tiled GeoTIFF datasets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, Dask Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>